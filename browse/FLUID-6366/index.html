<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-6366  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-6366 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-6366/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-6366/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-6366/">FLUID-6366</a></li>
            </ol>
        </nav>
        <h1>FLUID-6366: IoC Testing Framework's "task" idiom requires locutions when yielded value needs further use</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-6366">FLUID-6366</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Open</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2019-01-24T06:31:17.252-0500" prefix="">2019-01-24T06:31:17.252-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2019-01-24T06:31:17.252-0500" prefix="">2019-01-24T06:31:17.252-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Framework</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>Whilst the IoC testing framework makes small concessions to usability in the form of the "task" construct which yields a promise, the scoping of the values yielded from the promise suffers from all of the problems that led us to imagine that methods and invokers should be abolished. Here is a section of the GPII Preferences server tests:</p>
<pre><code class="hljs language-java">sequence: [{
    func: <span class="hljs-string">"gpii.tests.invokePromiseProducer"</span>,
    args: [<span class="hljs-string">"{preferencesService}.createPreferences"</span>, [gpii.tests.preferencesServer.preferencesService.testData.preferencesToCreate], <span class="hljs-string">"{that}"</span>]
}, {
    listener: <span class="hljs-string">"gpii.tests.invokePromiseProducer"</span>,
    args: [<span class="hljs-string">"{preferencesService}.getPrefsSafeByGpiiKey"</span>, [<span class="hljs-string">"{arguments}.0.gpiiKey"</span>], <span class="hljs-string">"{that}"</span>],
    event: <span class="hljs-string">"{that}.events.onResponse"</span>
}, {
    listener: <span class="hljs-string">"gpii.tests.preferencesServer.preferencesService.verifyFetchedPrefsSafe"</span>,
    args: [gpii.tests.preferencesServer.preferencesService.testData.preferencesToCreate, <span class="hljs-string">"{arguments}.0"</span>],
    event: <span class="hljs-string">"{that}.events.onResponse"</span>
}]
</code></pre>
<p>The author has been obliged to create not only a utility but a synthetic event, "onResponse", whose only purpose is to mediate the transmission of the yielded promise value. The implementation of gpii.tests.invokePromiseProducer is as follows:</p>
<pre><code class="hljs language-java">gpii.tests.invokePromiseProducer = function (producerFunc, args, that) {
    <span class="hljs-type">var</span> <span class="hljs-variable">promise</span> <span class="hljs-operator">=</span> producerFunc.apply(<span class="hljs-literal">null</span>, args);
    promise.then(function (response) {
        that.events.onResponse.fire(response);
    }, function (err) {
        that.events.onError.fire(err);
    });
};
</code></pre>
<p>This is ingenious but ought to be entirely unncessary. Unfortunately it doesn't seem like any lightweight, localised improvement to the IoC Testing Framework itself is likely to improve this problem very much, and we should subsume it into the general capabilities of "gyres" suggested in <a href="/browse/FLUID-6365/">FLUID-6365</a>. As well as the existing constructs that deal with methods, invokers, and promises, once this was a core framework feature, IoC Testing Framework features would then also be able to construct fixtures representing a "localised gyre".</p>
<p></p>

            </div>
            
            
            
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-6365/"><span class="aria-hidden">←</span> Previous: FLUID-6365</a>
        <a class="mx-1" href="/browse/FLUID-6367/">Next: FLUID-6367 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>