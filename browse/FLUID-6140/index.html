<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-6140  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-6140 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-6140/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-6140/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-6140/">FLUID-6140</a></li>
            </ol>
        </nav>
        <h1>FLUID-6140: Infusion self-deduping fails when infusion appears as a dependency of a tool used by infusion</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-6140">FLUID-6140</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2017-03-01T20:45:45.519-0500" prefix="">2017-03-01T20:45:45.519-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2017-04-10T11:54:11.707-0400" prefix="">2017-04-10T11:54:11.707-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Framework</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>A further pathological possibility has emerged for our "auto-self-deduping implementation" originally delivered for <a href="/browse/FLUID-5822/">FLUID-5822</a>. <a href="/browse/FLUID-6139/">FLUID-6139</a> shows work where infusion is being used as a dependency of one of its own devDependencies - in particular, the work to apply gpii-testem as an automated solution for running browser-based tests in testem together with istanbul coverage.</p>
<p>This case defeats our existing already rather tortured logic, because in this case, the "original infusion" (the one whose dev tools are now executing) is not loadable by the plain node require system at all - since it is not hosted in a directory named node_modules. This is the main use case for the "pre-inspection" system that was originally delivered to allow GPII universal test cases to run from an isolated checkout for <a href="https://issues.gpii.net/browse/GPII-2151">https://issues.gpii.net/browse/GPII-2151</a> - that is, the ability to issue, for example, fluid.require("%universal") rather than failing to run require("universal").</p>
<p>Unfortunately in this case we are completely hoist by our own petard since it would be impossible to run fluid.require("%infusion") before infusion itself has already successfully loaded. We will need to convolute our self-deduping logic yet further by applying a portion of the "pre-inspection" algorithm to defer to any such infusion that has already loaded from a higher path in the filesystem.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-22190">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2017-04-10T11:54:02.414-0400">2017-04-10T11:54:02.414-0400</relative-time></i></p>
                        <p><a href="https://github.com/fluid-project/infusion/pull/820">The pull request</a> has been merged into the project repo master branch at 5e835f6114ab60444ff65d5bcc7c5b0f8bb28873</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-6139/"><span class="aria-hidden">←</span> Previous: FLUID-6139</a>
        <a class="mx-1" href="/browse/FLUID-6141/">Next: FLUID-6141 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>