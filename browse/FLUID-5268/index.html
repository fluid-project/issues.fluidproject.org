<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-5268  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-5268 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-5268/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-5268/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-5268/">FLUID-5268</a></li>
            </ol>
        </nav>
        <h1>FLUID-5268: Newly implemented "afterDestroy" event does not function</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-5268">FLUID-5268</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2014-02-07T00:02:04.884-0500" prefix="">2014-02-07T00:02:04.884-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2015-06-17T10:30:45.203-0400" prefix="">2015-06-17T10:30:45.203-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>1.9</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Framework</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>As part of the <a href="/browse/FLUID-5185/">FLUID-5185</a> work it was required to implement a fresh event "afterDestroy" in order to correct a problem with the IoC framework clobbering markup belonging to test fixtures before their teardown was complete (important for Tooltip tests). Unfortunately this event was implemented hastily and in fact did not work at all - any listeners attached to it will not be notified. This causes tests written using the IoC testing framework to fail in a deceptive way - only the first fixture scheduled via fluid.tests.testTests would run and the rest would be ignored. This would make it appear that there were no failing tests, whereas in fact large numbers of the tests were just being skipped.</p>
<p>This turned out to be a bug with a reasonably sophisticated cause. Despite these listeners being successfully registered, the framework was being overeager in using the registration scheme operated by fluid.recordListener to strip them out again during the process of component destruction - thus by the time fluid.afterDestroy was invoked, they had all been removed.</p>
<p>We can take the opportunity to fix the bug as well as make fluid.recordListener more efficient - in fact there's no need for it to record listeners which are registered from the same component onto itself (which is how all conventional listener records appear to the IoC framework) since for these we assume the entire component will be GCed in any case. It is only critical to operate fluid.recordListener in cases where listeners are injected into other components in the tree, which would cause a leak if they were not removed along with the originating component.</p>
<p>Together with <a href="/browse/FLUID-4890/">FLUID-4890</a> this fix should produce a system which is more reliable as well as more efficient.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-20176">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2015-06-15T15:47:59.887-0400">2015-06-15T15:47:59.887-0400</relative-time></i></p>
                        <p>Merged into trunk at revision 0da0209c63c97cb3f422b8a21e4c8d33f4156d47 on November 9, 2014. There are still believed to be a few lingering bugs with fluid.recordListener</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-5267/"><span class="aria-hidden">←</span> Previous: FLUID-5267</a>
        <a class="mx-1" href="/browse/FLUID-5269/">Next: FLUID-5269 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>