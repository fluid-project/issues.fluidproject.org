<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-6178  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-6178 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-6178/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-6178/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-6178/">FLUID-6178</a></li>
            </ol>
        </nav>
        <h1>FLUID-6178: fluid.prettyPrintJSON fails to properly guard against exploding synthetic properties</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-6178">FLUID-6178</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2017-08-02T18:22:59.675-0400" prefix="">2017-08-02T18:22:59.675-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2024-07-22T09:04:50.247-0400" prefix="">2024-07-22T09:04:50.247-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Framework</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>Our fluid.prettyPrintJSON utility, used notably within the fluid.js fluid.renderLoggingArg monkey-patch which is used in the node environement, has code which attempts to guard against triggering synthetic properties which throw, but which is not completely effective.</p>
<p>In the pull request <a href="https://github.com/GPII/universal/pull/515">https://github.com/GPII/universal/pull/515</a> for <a href="/browse/GPII-2333/">GPII-2333</a>, Steve Grundell triggered a collateral failure in a test case as a result of issuing the configuration</p>
<pre><code class="hljs language-java">fluid.logObjectRenderChars = <span class="hljs-number">0xffffff</span>
</code></pre>
<p>This caused enough of an Infusion component to be rendered as a result of a fluid.describeActivity dump in the case of an expected test case failure that it tried to render a node "IncomingMessage" request object which had a faulty synthetic property for which the definition read</p>
<pre><code class="hljs language-java">defineGetter(req, <span class="hljs-string">'protocol'</span>, function <span class="hljs-title function_">protocol</span><span class="hljs-params">()</span> {
  <span class="hljs-type">var</span> <span class="hljs-variable">proto</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.connection.encrypted
    ? <span class="hljs-string">'https'</span>
    : <span class="hljs-string">'http'</span>;
</code></pre>
<p>In the case connection is not set, this property will throw on read access. We end up triggering this because the implementation of fluid.prettyPrintJSON invokes fluid.keys, which as the implementation comment indeed notes, "is not as clever as we think it is" and ends up unnecessarily evaluating all the values as well as the keys.</p>
<p>We can just replace this with Object.keys() which has been supperted in JS since IE9 - we may as well deprecate fluid.keys() whilst we are at it.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-22918">
                        <p class="mb-0"><b>Simon Bates</b> <i>commented <relative-time datetime="2017-09-26T10:21:00.187-0400">2017-09-26T10:21:00.187-0400</relative-time></i></p>
                        <p>Merged at&#160;<a href="https://github.com/fluid-project/infusion/commit/c86c007e392986fdd6441ad188225548b7a58cfd">https://github.com/fluid-project/infusion/commit/c86c007e392986fdd6441ad188225548b7a58cfd</a></p>
<p></p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-6177/"><span class="aria-hidden">←</span> Previous: FLUID-6177</a>
        <a class="mx-1" href="/browse/FLUID-6179/">Next: FLUID-6179 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>