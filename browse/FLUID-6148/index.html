<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-6148  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-6148 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-6148/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-6148/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-6148/">FLUID-6148</a></li>
            </ol>
        </nav>
        <h1>FLUID-6148: Implement "potentia II" constituting aligned, transactional records of author's creational intent</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-6148">FLUID-6148</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Improvement">Improvement</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2017-03-11T22:57:28.700-0500" prefix="">2017-03-11T22:57:28.700-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2024-07-22T10:35:19.741-0400" prefix="">2024-07-22T10:35:19.741-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>4.0</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>IoC System</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>As described in our paper <a href="https://github.com/amb26/papers/tree/master/ppig-2016a">https://github.com/amb26/papers/tree/master/ppig-2016a</a> , a desirable feature of an authorial system is to keep isolated records of the user's constructional intention. This allows the process of construction to be separated from the process of designating construction. Keeping these records would also allow us to solve issues such as <a href="/browse/FLUID-5614/">FLUID-5614</a> ("double deep trees"), <a href="/browse/FLUID-5028/">FLUID-5028</a> (continually arriving subcomponents) and <a href="/browse/FLUID-6146/">FLUID-6146</a> (multiple createOnEvent components for the same event), as well as preparing the ground for crucial requirements like <a href="/browse/FLUID-6147/">FLUID-6147</a>.</p>
<p>In the PPIG paper, we named this realm as "potentia II" to distinguish it from the existing realm of designating potential effects, the grade registry.</p>
<p>Our potentia II records need to be indexed by path as well as by sequence, as well as permitting multiple transactional records to be active simultaneously, designating components which must be considered non-interfering until their construction is complete. The concept of "complete construction" would be represented by a dynamically maintained queue of "fully reified components" - for example solving <a href="/browse/FLUID-6146/">FLUID-6146</a> by populating the inventory of createOnEvent components fully in advance (forming a single transaction), or <a href="/browse/FLUID-5028/">FLUID-5028</a> by enqueuing any further children of the same constructing root.</p>
<p>We decided to solve the issue of component destruction by prohibiting any component destruction during a construction transaction (as suggested in <a href="/browse/FLUID-5499/">FLUID-5499</a>) - a destruction operation must form its own, separate transaction. It's possible that in future we may support the aggregation of sequences of such transactions into "mega-transactions" allowing arbitarily complex operations on the component tree from being presented as a single atomic unit for the purposes of observation by other component tree citizens. This would be necessary in more mature Nexus applications, and would require explicit transaction demarcation to be supported in its wire protocol.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-25128">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2017-03-13T09:33:09.777-0400">2017-03-13T09:33:09.777-0400</relative-time></i></p>
                        <p>Implementation notes:</p>
<p>We already have the beginnings of a scheme for "mixed-mode" lookup - when we find a component whose type is not "constructed" we drop into slow mode for context resolution. We'll have to do something similar for transactions since we can't afford for each transaction to have its own set of scope chain objects. These will be a luxury only enjoyed by fully committed objects in the "main tree", enjoying fast invokers and listeners etc.</p>
<p>Our idea of "gingerness" naturally has to be extended to (now, in fact, <strong>only</strong>) make reference to the potentia II. As soon as a component begins to construct, we evaluate its "components" and transfer them into potentia II. Our iteration over children in initDependents then becomes an iteration over potentia II instead. We can repeatedly re-evaluate "components" and any fresh elements can be added to the queue of "pendingPotentia".</p>

                    </li>
                    
                    <li id="comment-25129">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2017-03-13T23:14:38.732-0400">2017-03-13T23:14:38.732-0400</relative-time></i></p>
                        <p>We seem to have a big problem with deletions. To start with, it seems impossible that we could ever cancel them - how could we undo the action of destroying a component? However, it also seems reasonable that they should be considered to never fail. This being the case, it would be great if we could arrange that transactions <strong>either</strong> only contained deletes <strong>or</strong> constructions. But the natural semantic of fluid.construct was to do a "deletion before construction", which threatens to naturally mix them up.</p>
<p>If we did the deletes first, and the constructs failed, we would be left with a tree that was permanently altered - since we could never back out the deletes.</p>
<p>If we do the constructs first, we could presumably "hide" the components to be destroyed somewhere. But in that case, if the constructs pass, how could we convince the component's destroy action to run sensibly? Presumably we could hide it in its own transactional world where it, and noone else, still believe it to be mounted at its old path.</p>
<p>Looks like this might be the workable option, as well as giving us "Queen of Sheba" semantics from the point of view of the outside world. But we have significant problems if people are expecting a "destroy, afterDestroy, create" sequence, for example, if a component or something it holds is being unregistered from some external container and then a new instance of it is re-registering. "create [possible failure], destroy, afterDestroy" seems a bit senseless, since we couldn't expect that the external container would be prepared to temporarily have two representatives of "the component" registered.</p>
<p>Presumably this fits in with the model that we want to prohibit a component from having side-effects on the external world before we are committed to successfully constructing it. This kind of registration clearly represents such a side-effect. But the current framework doesn't allow us this kind of fine-grained filtration of a component's effects. The idea that events were only constructed "onCreate" was a kind of appeal to this idea - by the time we have reached onCreate our construction is fully committed.</p>
<p>Does this suggest that we should schedule the "destroy" moment for the component previously in the same place in the "suspension interval" of the previous component? As we said before, we would naturally like this to be a little later - some time after we have evaluated most of its options but before it has started to have any side-effects (which you would imagine had definitely occurred by the time its "onCreate" event occurred).</p>
<p>This then allows us the possibility to retain (destroy, afterDestroy, create) as the sequence, even though the components actually overlap in memory. We are left with the risk that a "static failure" could still occur during further options evaluation, even though we are then committed to destroying the component's predecessor, leaving its space in the tree empty. This is of course still vastly better than we could ever do before, and seems like the kind of "quality of implementation" issue we should tolerate until we can improve the framework.</p>
<p>Ah well, of course - the whole point of the "potentia" model is that the <strong>PREVIOUS POTENTIA</strong> can be recovered! This is obviously how we need to undo deletions. Much more straightforward - this implies that the component's potentia remains around for its entire lifetime.</p>

                    </li>
                    
                    <li id="comment-25130">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2017-03-18T13:39:48.722-0400">2017-03-18T13:39:48.722-0400</relative-time></i></p>
                        <p>In a conversation with Clayton I found this interesting prehistoric comment left in the buffer from 29th July 2015, which shows the beginnings of the "potentia/extensa" split beginning to be grasped:</p>
<p>My 7am noodlings, I think, have resolved the (non)-issue of GRADES OF NECESSITY........<br>
As well as settling what demo we can very convincingly do for our Ungar-directed paper<br>
The solution to "grades of necessity" is vastly simpler than I thought..... the idea of "grades of necessity" unnecessarily couples together the worlds of WHAT KINDS OF THINGS CAN EXIST and WHAT THINGS DO EXIST<br>
All we need to do is to interpret a directive to destroy a component (whatever it is) at location A as a directive that that component SHOULD NOT EXIST (which clearly it obviously implies)<br>
But that the effect of honouring the directive that it should not exist does indeed consist of two parts - firstly, ACTUALLY DESTROYING IT (the normal effect in an object-oriented system) but in addition REMOVING THE PREVIOUSLY EXISTING ANNOTATION THAT IT SHOULD EXIST (which has no meaning in an OO system, separate from executing the code which constructed it, but in our system actually corresponds to a persistent declaration kept in a registry) .........</p>

                    </li>
                    
                    <li id="comment-25131">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2018-10-16T13:03:00.754-0400">2018-10-16T13:03:00.754-0400</relative-time></i></p>
                        <p>Merged&#160;<a href="https://github.com/GPII/universal/pull/687">the </a> <a href="https://github.com/GPII/universal/pull/687">corresponding</a> <a href="https://github.com/GPII/universal/pull/687">&#160;universal pull request</a> at <a href="https://github.com/GPII/universal/commit/47e53b95ca4e1e8b48b1a47009ba1eaa47316165">this commit.</a></p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-6147/"><span class="aria-hidden">←</span> Previous: FLUID-6147</a>
        <a class="mx-1" href="/browse/FLUID-6149/">Next: FLUID-6149 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>