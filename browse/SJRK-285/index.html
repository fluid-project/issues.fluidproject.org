<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> SJRK-285  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" SJRK-285 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/SJRK-285/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/SJRK-285/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/SJRK" data-pagefind-filter="project">Social Justice Repair Kit</a></li>
                <li><a href="/browse/SJRK-285/">SJRK-285</a></li>
            </ol>
        </nav>
        <h1>SJRK-285: Add nginx to docker-compose and customize client_max_body_size</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/SJRK-285">SJRK-285</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/SJRK/?type=Task">Task</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Blocker</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Open</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>N/A</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/SJRK/?reporter=Gregor%20Moss">Gregor Moss</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2019-09-12T19:35:36.145-0400" prefix="">2019-09-12T19:35:36.145-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2020-05-06T16:31:51.696-0400" prefix="">2020-05-06T16:31:51.696-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Storytelling Tool Server</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>Configure the nginx&#160;client_max_body_size in the Dockerfile or docker-compose.yml file in order to make sure we no longer run into issues of deployments with maximum request sizes of 1 MB. Set the value to 2GB.</p>
<p>Whether it is possible to configure this setting in Docker, specifying and checking this setting should be added as a server setup step in README.md</p>
<p>Currently, the docker-compose configuration doesn't have Nginx in front of the Story telling tool. Nginx should be added in a 3-tier app deployment configuration to better mimick what is deployed in production.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-26381">
                        <p class="mb-0"><b>Giovanni Tirloni</b> <i>commented <relative-time datetime="2020-05-06T15:56:23.866-0400">2020-05-06T15:56:23.866-0400</relative-time></i></p>
                        <p>The deployment that is done through docker-compose exposes the node application directly, without Nginx fronting it.</p>
<p>The actual deployments in production do have Nginx in front of them acting as a load balancer but the configuration for that piece of the infrastructure is not done in docker-compose (it's in a separate "ops" repo using Ansible).</p>
<p>All stories websites in production have been updated to use a 2GB client_max_body_size</p>

                    </li>
                    
                    <li id="comment-26382">
                        <p class="mb-0"><b>Gregor Moss</b> <i>commented <relative-time datetime="2020-05-06T16:11:41.442-0400">2020-05-06T16:11:41.442-0400</relative-time></i></p>
                        <p>Thanks for the clarification, Gio! The purpose of this Jira is to ensure that we don't accidentally have a new deployment with the client_max_body_size set to its default value. If we can configure this in a persistent manner (i.e. along with the site source, or some other associated repo), then I think we're where we want to be.</p>
<p>If that means setting it in an Ansible playbook that we can use for all Storytelling Tool deployments, that would fit the bill nicely!</p>

                    </li>
                    
                    <li id="comment-26383">
                        <p class="mb-0"><b>Giovanni Tirloni</b> <i>commented <relative-time datetime="2020-05-06T16:16:18.660-0400">2020-05-06T16:16:18.660-0400</relative-time></i></p>
                        <p>In our environment, it's just a piece of configuration data used by the Ansible playbooks that deploy the load balancers.</p>
<p>But maybe what we're hinting here is that the docker-compose deployment should include Nginx to be closer to production deployments as much as possible. In that case it'd make sense to have the max upload size configured there (but it still requires the infrastructure owner to configure all the upstream load balancers to accept it as well).</p>
<p>I think we could leave this JIRA open and amend it to say "add Nginx" to docker-compose AND ensure the 2GB limit is set there. WDYT?</p>

                    </li>
                    
                    <li id="comment-26384">
                        <p class="mb-0"><b>Gregor Moss</b> <i>commented <relative-time datetime="2020-05-06T16:29:11.742-0400">2020-05-06T16:29:11.742-0400</relative-time></i></p>
                        <p>That sounds like a reasonable amendment üôÇ</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/SJRK-284/"><span class="aria-hidden">‚Üê</span> Previous: SJRK-284</a>
        <a class="mx-1" href="/browse/SJRK-286/">Next: SJRK-286 <span class="aria-hidden">‚Üí</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>