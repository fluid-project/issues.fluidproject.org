<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> SJRK-433  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" SJRK-433 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/SJRK-433/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/SJRK-433/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/SJRK" data-pagefind-filter="project">Social Justice Repair Kit</a></li>
                <li><a href="/browse/SJRK-433/">SJRK-433</a></li>
            </ol>
        </nav>
        <h1>SJRK-433: Database migration scripts should exit gracefully</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/SJRK-433">SJRK-433</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/SJRK/?type=Improvement">Improvement</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Open</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>N/A</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/SJRK/?reporter=Gregor%20Moss">Gregor Moss</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2020-12-02T12:26:01.468-0500" prefix="">2020-12-02T12:26:01.468-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2020-12-02T12:28:17.461-0500" prefix="">2020-12-02T12:28:17.461-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Storytelling Tool Server</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>The current database migration script ("undefined to 0.0.1") does not exit gracefully when validation issues are spotted. This should probably exit with code 0 if a story has validation issues, rather than exiting with code 1. Code 1 (or other non-zero codes) should be reserved for "actual" errors, i.e. issues connecting to the database, write errors, etc.</p>
<p>To illustrate the need for this change, the latest migration of the SJRK Stories site ran correctly, but raised two validation issues (which were expected) and therefore exited with code 1, indicating an error had occurred:</p>
<pre><code class="hljs language-java">bash-<span class="hljs-number">5.0</span># node migrate_undefined_to_0<span class="hljs-number">.0</span><span class="hljs-number">.1</span>.js http:<span class="hljs-comment">//db:5984/stories</span>
.
.
. (glossing over many updates)
.
.
<span class="hljs-number">14</span>:<span class="hljs-number">29</span>:<span class="hljs-number">22.102</span>:  Updating the story with ID: f378a100-f11f-<span class="hljs-number">11e9</span>-<span class="hljs-number">9409</span>-319b90678833
<span class="hljs-number">14</span>:<span class="hljs-number">29</span>:<span class="hljs-number">22.102</span>:  Updating the story with ID: storyExample
<span class="hljs-number">14</span>:<span class="hljs-number">29</span>:<span class="hljs-number">22.492</span>:  -- -- --
<span class="hljs-number">14</span>:<span class="hljs-number">29</span>:<span class="hljs-number">22.492</span>:  Updated <span class="hljs-number">21</span> of <span class="hljs-number">22</span> documents.
<span class="hljs-number">14</span>:<span class="hljs-number">29</span>:<span class="hljs-number">22.492</span>:  -- -- --
<span class="hljs-number">14</span>:<span class="hljs-number">29</span>:<span class="hljs-number">22.526</span>:  eba1c640-f863-11ea-9fdd-552aa35bda8b is invalid:
<span class="hljs-number">14</span>:<span class="hljs-number">29</span>:<span class="hljs-number">22.526</span>:  - Block at index <span class="hljs-number">9</span>: key <span class="hljs-string">'order'</span> does not have the expected value of <span class="hljs-string">'9'</span> and is instead <span class="hljs-string">'10'</span>
<span class="hljs-number">14</span>:<span class="hljs-number">29</span>:<span class="hljs-number">22.527</span>:  - Block at index <span class="hljs-number">10</span>: key <span class="hljs-string">'order'</span> does not have the expected value of <span class="hljs-string">'10'</span> and is instead <span class="hljs-string">'9'</span>
<span class="hljs-number">14</span>:<span class="hljs-number">29</span>:<span class="hljs-number">22.527</span>:  --
<span class="hljs-number">14</span>:<span class="hljs-number">29</span>:<span class="hljs-number">22.528</span>:  FATAL ERROR: Uncaught exception: <span class="hljs-number">1</span> invalid document <span class="hljs-title function_">detected</span>
<span class="hljs-params">(No error stack)</span>
</code></pre>

            </div>
            
            
            
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/SJRK-432/"><span class="aria-hidden">←</span> Previous: SJRK-432</a>
        <a class="mx-1" href="/browse/SJRK-434/">Next: SJRK-434 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>