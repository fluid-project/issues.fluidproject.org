<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-6406  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-6406 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-6406/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-6406/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-6406/">FLUID-6406</a></li>
            </ol>
        </nav>
        <h1>FLUID-6406: Workflow scheduling algorithm allows an early block of instantiating components to run ahead of successors</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-6406">FLUID-6406</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2019-10-03T18:05:41.645-0400" prefix="">2019-10-03T18:05:41.645-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2024-07-22T10:35:31.322-0400" prefix="">2024-07-22T10:35:31.322-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>4.0</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>IoC System</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>This issue only affects the <a href="/browse/FLUID-6148/">FLUID-6148</a> in-progress branch.<br>
The original version of the workflow scheduling algorithm, codenamed "ModelComponentQix" did not satisfy the original goals of always proceeding with the workflow of the least advanced component in the instantiating set. <br>
This was discovered when attempting to reform the GPII app's dialog instantiation workflow by means of an "intermediate dodge" of a lensed component defined purely to hoist the instantiation of the electron BrowserWindow until after model resolution, since its instantiation parameters depended on some model material. <br>
In outline we had:</p>
<pre><code class="hljs language-java">fluid.defaults(<span class="hljs-string">"gpii.app.dialog"</span>, {
....
    dynamicComponents: {
        <span class="hljs-comment">// Resolution for <a href="/browse/GPII-4147/">GPII-4147</a> to defer construction of the dialog until the component's model has been resolved</span>
        dialogLoader: {
            type: <span class="hljs-string">"fluid.modelComponent"</span>,
            source: <span class="hljs-string">"{that}.model"</span>,
....
        },
    members: {
        dialog: <span class="hljs-string">"{that}.dialogLoader.dialog"</span>
    }
}
</code></pre>
<p>In theory we should be able to guarantee that in the absence of an observer, evaluation of the shorthand member "dialog" (and any other similar late option observer) could not run ahead of the component. In practice, the algorithm, which we originally named "ModelComponentQix" would stubbornly progress the instantiation of an earlier workflow block even after a the group of "dialogLoader" lensed components had been contributed into the transaction record, by the original implementation</p>
<pre><code class="hljs language-java">fluid.applyWorkflowPhase = function (transRec, sequencer) {
        <span class="hljs-type">var</span> <span class="hljs-variable">shadows</span> <span class="hljs-operator">=</span> transRec.outputShadows;
        <span class="hljs-comment">// Bring any freshly created shadows to the same level as the most currently advanced</span>
        <span class="hljs-keyword">if</span> (shadows.length &gt; transRec.lastWorkflowShadow &amp;&amp; transRec.maximumWorkflowStage &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> fluid.enqueueWorkflowBlock(transRec, shadows, <span class="hljs-number">0</span>, transRec.maximumWorkflowStage,
                transRec.lastWorkflowShadow, shadows.length, sequencer);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (transRec.maximumWorkflowStage &lt; transRec.workflowStageBreak) {
            <span class="hljs-comment">// They must all be level - bring the level of all shadows to final level</span>
            <span class="hljs-keyword">return</span> fluid.enqueueWorkflowBlock(transRec, shadows, transRec.maximumWorkflowStage, transRec.workflowStageBreak,
                <span class="hljs-number">0</span>, shadows.length, sequencer);
        }
    };
</code></pre>
<p>The error is in the first branch, which always enqueues a early block up to the maximum workflow stage. Correctly, it should only enqueue a single strip at the next workflow stage, to ensure that they run ahead of freshly enqueued components to the smallest extent.</p>

            </div>
            
            
            
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-6405/"><span class="aria-hidden">←</span> Previous: FLUID-6405</a>
        <a class="mx-1" href="/browse/FLUID-6407/">Next: FLUID-6407 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>