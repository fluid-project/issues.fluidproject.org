<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-3233  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-3233 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-3233/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-3233/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-3233/">FLUID-3233</a></li>
            </ol>
        </nav>
        <h1>FLUID-3233: After download, progress on "Preparing your download..." page does not disappear  </h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-3233">FLUID-3233</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Blocker</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Cindy Li</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Alison%20Benjamin">Alison Benjamin</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2009-10-06T14:13:18.000-0400" prefix="">2009-10-06T14:13:18.000-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2010-11-16T10:38:56.596-0500" prefix="">2010-11-16T10:38:56.596-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>1.2</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>1.3</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Infusion Builder</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>After a package has been downloaded, the progress on "Preparing your download..." continues. Maybe there should be a "Thank you for downloading infusion" message. </p>

            </div>
            
            <div class="spacing-y-1">
                <h2>Environments</h2>
                <p>Safari 3.2, FF3 </p>

            </div>
            
            
            
            <div class="spacing-y-1">
                <h2>Attachments</h2>
                <ul class="spacing-y-1" role="list">
                    
                    <li>
                        <a href="https://idrc.cachefly.net/issues.fluidproject.org/FLUID/FLUID-3233/FLUID-3233-1.patch.txt">
                            
                                FLUID-3233-1.patch.txt
                            
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://idrc.cachefly.net/issues.fluidproject.org/FLUID/FLUID-3233/FLUID-3233-2.patch.txt">
                            
                                FLUID-3233-2.patch.txt
                            
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://idrc.cachefly.net/issues.fluidproject.org/FLUID/FLUID-3233/FLUID-3233-3.patch.txt">
                            
                                FLUID-3233-3.patch.txt
                            
                        </a>
                    </li>
                    
                </ul>
            </div>
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-14603">
                        <p class="mb-0"><b>Laurel Williams</b> <i>commented <relative-time datetime="2009-12-04T11:06:21.000-0500">2009-12-04T11:06:21.000-0500</relative-time></i></p>
                        <p>This is related to the css re-design for Infusion Builder that Jacob is already doing so I am re-assigning this task to Jacob</p>

                    </li>
                    
                    <li id="comment-14605">
                        <p class="mb-0"><b>Justin Obara</b> <i>commented <relative-time datetime="2010-01-07T08:28:11.000-0500">2010-01-07T08:28:11.000-0500</relative-time></i></p>
                        <p>This issue has been raised by several people now and is something we should address by the next release of the builder. </p>
<p>The problem is that we don't have any knowledge of when the download is ready or when it has been successfully received by the user. </p>
<p>A redesign, with the above constraint in mind, is needed.</p>

                    </li>
                    
                    <li id="comment-14606">
                        <p class="mb-0"><b>Jacob Farber</b> <i>commented <relative-time datetime="2010-03-26T15:28:18.000-0400">2010-03-26T15:28:18.000-0400</relative-time></i></p>
                        <p>I would look to see what SourceForge or other large download sites do, and mimick that.</p>

                    </li>
                    
                    <li id="comment-14608">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2010-09-07T13:27:26.484-0400">2010-09-07T13:27:26.484-0400</relative-time></i></p>
                        <p>One suggested solution is that the server script redirects or refreshes the page once the download completes. This is not doable because the way at server side to trigger the download is, first of all, send http header telling the browser that this response is for download, secondly, all the server output following this http header is the content of the downloaded file. All the redirection or whatever message after the download content will be considered as a part of the download content.</p>
<p>After browsing through a few download site like sourceforge and download.com, a general solution is to change the message to "The download will start shortly ..." and the page stays as it is before and after download.</p>

                    </li>
                    
                    <li id="comment-14610">
                        <p class="mb-0"><b>Justin Obara</b> <i>commented <relative-time datetime="2010-09-07T16:00:42.616-0400">2010-09-07T16:00:42.616-0400</relative-time></i></p>
                        <p>Here's a strategy that should work:</p>
<p>1. The client POSTs to the server via Ajax, requesting a build to be made<br>
2. The server responds immediately with a response object, which will provide:<br>
a) a URL to the .zip file to download<br>
b) a status code--either "ready" or "building"<br>
3. If the status is "ready", the client should hide the spinner, and then immediately download the zip file (e.g. by setting the window.location to the URL)<br>
4. A mini "status" service should be provided by the server, allowing the client to periodically "ping" the build's status</p>

                    </li>
                    
                    <li id="comment-14612">
                        <p class="mb-0"><b>Harris Wong</b> <i>commented <relative-time datetime="2010-09-10T10:43:20.289-0400">2010-09-10T10:43:20.289-0400</relative-time></i></p>
                        <p>Quick flow diagram:<br>
-&gt; page loads<br>
-&gt;ajax post to generate a build, builder.php<br>
-&gt; button.disable()<br>
-&gt; spinner.spin()<br>
-&gt;call back function -&gt; done <br>
-&gt; button.enable()<br>
-&gt; spinner.disappear()<br>
-&gt; download, display content-disposition: attachment<br>
-&gt; ajax -&gt; get.php?file.zip -&gt;download popup</p>

                    </li>
                    
                    <li id="comment-14614">
                        <p class="mb-0"><b>Justin Obara</b> <i>commented <relative-time datetime="2010-10-04T15:26:05.277-0400">2010-10-04T15:26:05.277-0400</relative-time></i></p>
                        <p>"Bug Parade Infusion 1.3"</p>

                    </li>
                    
                    <li id="comment-14615">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2010-10-22T11:54:35.619-0400">2010-10-22T11:54:35.619-0400</relative-time></i></p>
                        <p>"<a href="/browse/FLUID-3233/">FLUID-3233</a>-1.patch.txt" includes changes:<br>
1. PHP server side: <br>
1.1 added "get.php" to retrieve and return back the requested build.<br>
2. HTML client side: <br>
2.1 make ajax call to request for the build, handle server error response;<br>
2.2 when the build is in process, display a spinner on "Download" button and disable all the controls (checkboxes, radio buttons, buttons);<br>
2.3 when the build is received, hide the spinner and enable controls.<br>
3. New unit tests for the changes at both sides. Improved server-side unit test structure:<br>
3.1 added one general test script to include all individual unit test scripts;<br>
3.2 added a config file to define all the paths and constants used in server test cases;<br>
3.3 wrote a Simple Test (the PHP unit test software used by infusion builder) skin to display what test cases are run.</p>
<p>Some remain issues are:<br>
1. In firefox, the spinner only spins the first time after the page refresh. After then, the spinner no longer spins. This is a known bug filed in firefox (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=129986">https://bugzilla.mozilla.org/show_bug.cgi?id=129986</a>). It does not happen with other browsers (IE8, Chrome7, Safari 5.0.2), tested on Windows XP. <br>
2. Some client-side unit tests fail at IE8 (<a href="http://issues.fluidproject.org/browse/FLUID-3231">http://issues.fluidproject.org/browse/FLUID-3231</a>).</p>

                    </li>
                    
                    <li id="comment-14618">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2010-10-25T15:11:44.849-0400">2010-10-25T15:11:44.849-0400</relative-time></i></p>
                        <p>"<a href="/browse/FLUID-3233/">FLUID-3233</a>-2.patch.txt" contains all the changes in "<a href="/browse/FLUID-3233/">FLUID-3233</a>-1.patch.txt" plus the handling of the case when "magic_quotes_gpc" is turned on in php.ini. So the first patch "<a href="/browse/FLUID-3233/">FLUID-3233</a>-1.patch.txt" can be ignored since it has not been applied.</p>
<p>Below is a detail description of what the new fix for:<br>
The $_GET data accepted by "get.php" is supposed to be ["17_1.1.2",1]. When "magic_quotes_gpc" is on, the sent-in $_GET is turned into [\"17_1.1.2\",1]. The fix is to strip the slashes when "magic_quotes_gpc" is on.</p>

                    </li>
                    
                    <li id="comment-14620">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2010-10-28T10:51:38.176-0400">2010-10-28T10:51:38.176-0400</relative-time></i></p>
                        <p>"<a href="/browse/FLUID-3233/">FLUID-3233</a>-3.patch.txt" has these improvements:</p>
<p>1. A workaround for firefox spinner bug: embed a hidden iframe to download build;<br>
2. Use http status code to identify server success or fail response;<br>
3. Move spinner out of download button so the disable opacity only applies to button not the spinner.</p>
<p>"<a href="/browse/FLUID-3233/">FLUID-3233</a>-1.patch.txt" &amp; "<a href="/browse/FLUID-3233/">FLUID-3233</a>-2.patch.txt" can be ignored.</p>

                    </li>
                    
                    <li id="comment-14622">
                        <p class="mb-0"><b>Michelle D'Souza</b> <i>commented <relative-time datetime="2010-11-02T14:39:47.556-0400">2010-11-02T14:39:47.556-0400</relative-time></i></p>
                        <p>Fixed at revision 10172. <br>
Cindy, please ensure everything got committed as you expected it to. </p>

                    </li>
                    
                    <li id="comment-14623">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2010-11-02T14:56:32.671-0400">2010-11-02T14:56:32.671-0400</relative-time></i></p>
                        <p>The patch is reviewed by Colin/Michelle and committed by Michelle in svn revision 10172.</p>

                    </li>
                    
                    <li id="comment-14625">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2010-11-16T10:00:53.989-0500">2010-11-16T10:00:53.989-0500</relative-time></i></p>
                        <p>Add more explanations on how the iframe work-around for firefox spinner bug works.</p>

                    </li>
                    
                    <li id="comment-14626">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2010-11-16T10:37:44.815-0500">2010-11-16T10:37:44.815-0500</relative-time></i></p>
                        <p>Why do we embed an empty iframe in builder html?</p>
<p>In general, this is a workaround for the firefox spinner bug (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=129986">https://bugzilla.mozilla.org/show_bug.cgi?id=129986</a>) that the spinner only spins the first time after the page loads. </p>
<p>In detail, the ff bug is trigger by the line of javascript that retrieves the download: </p>
<p>window.location = "download.php"</p>
<p>download.php pushes down the zipped download file along with such http header:</p>
<p>header("Content-Type: archive/zip");<br>
header("Content-Disposition: attachment; filename=$filename");<br>
header("Content-Length: $size");</p>
<p>These headers tell the browser this is a download so the browser pops up the download dialog box without truly re-directing the page itself.</p>
<p>But, even though the page stays as it is, the firefox bug is triggered and the spinner stops spinning since then.</p>
<p>One suggested solution is to use ajax to retrieve download, not via window.location. This suggestion is tried but doesn't help because ajax swallows the http header and the download dialog would not be popped up.</p>
<p>In the end, the empty iframe comes into the play. Instead of using window.location = "download.php", now we use:</p>
<p>that.locate("downloadFrame").attr('src', "../php/download.php?path="+data);</p>
<p>Problem solved!</p>

                    </li>
                    
                    <li id="comment-14628">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2010-11-16T10:38:56.594-0500">2010-11-16T10:38:56.594-0500</relative-time></i></p>
                        <p>Added more comments.</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-3232/"><span class="aria-hidden">←</span> Previous: FLUID-3232</a>
        <a class="mx-1" href="/browse/FLUID-3234/">Next: FLUID-3234 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>