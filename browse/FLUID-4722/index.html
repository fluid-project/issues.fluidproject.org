<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-4722  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-4722 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-4722/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-4722/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-4722/">FLUID-4722</a></li>
            </ol>
        </nav>
        <h1>FLUID-4722: Need some framework support for clearing listeners that belong to components that have shorter lifecycle than the event firer.</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-4722">FLUID-4722</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Improvement">Improvement</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=y%20z">y z</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2012-06-14T14:50:43.037-0400" prefix="">2012-06-14T14:50:43.037-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2014-03-03T12:51:29.081-0500" prefix="">2014-03-03T12:51:29.081-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>1.4</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>1.5</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Framework</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>There is a lingering issue where there might be some additional framework support necessary at the time when the component is being cleared away. In particular this issue is very evident when the component that is being cleared attached listener(s) to the event(s) that have longer lifecycle that the component itself. Even though the component will be cleared away, the listener that is nothing but a function object is still present and will be executed on event fire.</p>
<p>Proposed solution would require an addition of another lifecycle function that is only executed on the component clearance - a so called clearFunction. This function is the last point where there's a chance to remove such listeners. Also, we can impose an informal contract where the user would not need to declare such clear function if the listener(s) are specified declaratively and with a namespace. For that to work we would need to implement a "default" clearFunction for "fluid.eventedComponent" grade that will automatically clear all such listeners from the component.</p>
<p>Here's a pasted patch that I used in cspace's infusion :<br>
— a/src/main/webapp/defaults/lib/infusion/CSpaceInfusion.js<br>
+++ b/src/main/webapp/defaults/lib/infusion/CSpaceInfusion.js<br>
-11157,7 +11157,8  var fluid = fluid || fluid_1_5;<br>
fluid.lifecycleFunctions = {<br>
preInitFunction: true,<br>
postInitFunction: true,</p>
<ul>
<li>       finalInitFunction: true<br>
+        finalInitFunction: true,<br>
+        clearFunction: false<br>
     };</li>
</ul>
<p>     <br>
fluid.rootMergePolicy = fluid.transform(fluid.lifecycleFunctions, function () {<br>
-11275,11 +11276,26  var fluid = fluid || fluid_1_5;<br>
options: 0<br>
}<br>
});<br>
+<br>
+    fluid.clearEventedComponent = function (that) {<br>
+        // Remove all declaratively attached event listeners that have a namespace.<br>
+        fluid.each(that.options.listeners, function (listener, eventName) {<br>
+            var namespace = listener.namespace;<br>
+            if (!namespace) {<br>
+                return;<br>
+            }<br>
+            that.events[eventName].removeListener(namespace);<br>
+        });<br>
+    };</p>
<p>fluid.defaults("fluid.eventedComponent", {<br>
gradeNames: ["fluid.littleComponent"],<br>
mergePolicy: {<br>
listeners: fluid.mergeListenersPolicy<br>
+        },<br>
+        clearFunction: {<br>
+            namespace: "clearEventedComponent",<br>
+            listener: "fluid.clearEventedComponent"<br>
}<br>
});</p>
<p>-11556,6 +11572,9  var fluid = fluid || fluid_1_5;</p>
<p>fluid.clearLifecycleFunctions = function (options) {<br>
fluid.each(fluid.lifecycleFunctions, function (value, key) {<br>
+            if (!value) {<br>
+                return;<br>
+            }<br>
delete options[key];<br>
});<br>
delete options.initFunction; <br>
-14710,6 +14729,7  var fluid_1_5 = fluid_1_5 || {};<br>
that.clearComponent = function(component, name, child, options, noModTree) {<br>
options = options || {visited: {}, flat: true};<br>
child = child || component[name];<br>
+            fluid.fireEvent(child.options.clearFunction, child);<br>
fluid.visitComponentChildren(child, function(gchild, gchildname) {<br>
that.clearComponent(child, gchildname, null, options, noModTree);<br>
}, options);</p>

            </div>
            
            <div class="spacing-y-1">
                <h2>Environments</h2>
                <p>Any</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-15759">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2012-08-16T02:27:21.598-0400">2012-08-16T02:27:21.598-0400</relative-time></i></p>
                        <p>These events and also framework assistance for auto-removal of listeners added through boiling will be provided as part of the <a href="/browse/FLUID-4257/">FLUID-4257</a> work</p>

                    </li>
                    
                    <li id="comment-15760">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2012-08-22T14:59:02.215-0400">2012-08-22T14:59:02.215-0400</relative-time></i></p>
                        <p>Functionality delivered for <a href="/browse/FLUID-4257/">FLUID-4257</a> now includes support for automatically deregistering listeners which were attached from components with shorter scopes. We probably need some more test cases to cover a few more special cases. The semantic implemented is that listeners that are registered <strong>BY</strong> any component - that is - which appear in its configuration - are cleared when the component is cleared - whether the listeners actually bind onto the cleared component or not.</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-4721/"><span class="aria-hidden">←</span> Previous: FLUID-4721</a>
        <a class="mx-1" href="/browse/FLUID-4723/">Next: FLUID-4723 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>