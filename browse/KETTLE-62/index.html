<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> KETTLE-62  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" KETTLE-62 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/KETTLE-62/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/KETTLE-62/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/KETTLE" data-pagefind-filter="project">Kettle</a></li>
                <li><a href="/browse/KETTLE-62/">KETTLE-62</a></li>
            </ol>
        </nav>
        <h1>KETTLE-62: Ability to specify default value for environment variable lookup</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/KETTLE-62">KETTLE-62</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/KETTLE/?type=Improvement">Improvement</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Resolved</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/KETTLE/?resolution=Won't%20Fix">Won't Fix</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/KETTLE/?reporter=Giovanni%20Tirloni">Giovanni Tirloni</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2017-07-03T15:42:21.569-0400" prefix="">2017-07-03T15:42:21.569-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2017-07-05T09:58:15.951-0400" prefix="">2017-07-05T09:58:15.951-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>While working with configuration files that depend on environment variables, it would be useful to have default values that are used in case the environment variable is missing.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-26112">
                        <p class="mb-0"><b>Giovanni Tirloni</b> <i>commented <relative-time datetime="2017-07-03T16:21:19.962-0400">2017-07-03T16:21:19.962-0400</relative-time></i></p>
                        <p>I've submitted a PR to show what I mean by this. Please let me know if this approach is acceptable.</p>
<p><a href="https://github.com/fluid-project/kettle/pull/34">https://github.com/fluid-project/kettle/pull/34</a></p>
<p>Discussion with Cindy Li Justin Obara Michelle D'Souza:&#160;<a href="https://botbot.me/freenode/fluid-work/2017-06-29/?msg=87941169&page=1">https://botbot.me/freenode/fluid-work/2017-06-29/?msg=87941169&amp;page=1</a></p>

                    </li>
                    
                    <li id="comment-26113">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2017-07-05T09:24:14.470-0400">2017-07-05T09:24:14.470-0400</relative-time></i></p>
                        <p>Hi - the pull request in itself is of high quality, since it targets limited functionality and has a good test case and JIRA writeup. However, the approach isn't the best one - to start with, it seems peculiar to just fix one resolver without fixing them all - this creates an inconsistency in their contracts. But going on, I think it seems clear that using up the 2nd argument slot for every resolver for this generally unrelated concern is quite an intrusion on the whole space of resolvers (of which we have 3, but expect users to contribute many more).</p>
<p></p>
<p>In fact this kind of "value resolution creep" is exactly what Infusion is designed to avoid. If there is a detailed arbitration required between different values with different priorities, these should each be written in options distributions with an explicit "priority" field indicating which values takes priority over which.</p>
<p></p>
<p>The row of this table <a href="http://docs.fluidproject.org/infusion/development/Priorities.html#table-of-supported-sites-for-priorities-and-namespaces">http://docs.fluidproject.org/infusion/development/Priorities.html#table-of-supported-sites-for-priorities-and-namespaces</a>&#160;for "distributeOptions" is the relevant one. It explains that priorities that are listed as "after" the namespace of another distribution will merge on top of it. In general in the absence of distributions, options in derived configs (grades) will take priority over those in base grades (configs). This is explained in the docs here: <a href="http://docs.fluidproject.org/infusion/development/ComponentGrades.html#combining-grades">http://docs.fluidproject.org/infusion/development/ComponentGrades.html#combining-grades</a></p>
<p></p>
<p>In the comment <a href="https://github.com/GPII/universal/pull/522/files#r125638565">https://github.com/GPII/universal/pull/522/files#r125638565</a>&#160;on the universal pull request, I showed an example of how you can achieve the defaulting effect you want without needing to change the definitions of the resolvers:</p>
<p></p>
<pre><code class="hljs language-java"><span class="hljs-string">"distributeOptions"</span>: {
            <span class="hljs-string">"preferencesDataSource.productionDataSource"</span>: {
                <span class="hljs-string">"record"</span>: {
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"kettle.dataSource.URL"</span>,
                    <span class="hljs-string">"options"</span>: {
                        <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://preferences.gpii.net/preferences/%userToken"</span>
                    }
                 },
                 <span class="hljs-string">"target"</span>: <span class="hljs-string">"{that flowManager preferencesDataSource}"</span>
             },
             <span class="hljs-string">"preferencesDataSource.productionEnvUrl"</span>: {
                 <span class="hljs-string">"record"</span>: <span class="hljs-string">"@expand:kettle.resolvers.env(GPII_FLOWMANAGER_PREFERENCES_URL)"</span>,
                 <span class="hljs-string">"target"</span>: <span class="hljs-string">"{that flowManager.preferencesDataSource}.options.url"</span>,
                 <span class="hljs-string">"priority"</span>: <span class="hljs-string">"after:preferencesDataSource.productionDataSource"</span>
             }
        }
</code></pre>
<p>It's a good opportunity to start removing cruft from our configs, in any case, and thinking a bit more clearly about how they are meant to relate to each other.</p>
<p>Note that namespace names are "free" but we tend to adopt a convention of having two-part names where the first part refers to the configuration which is being modified, and the 2nd refers to the reason.</p>

                    </li>
                    
                    <li id="comment-26114">
                        <p class="mb-0"><b>Giovanni Tirloni</b> <i>commented <relative-time datetime="2017-07-05T09:57:32.295-0400">2017-07-05T09:57:32.295-0400</relative-time></i></p>
                        <p>Thanks for the explanation, it makes perfect sense. I was ignorant about priorities and how they could help in this situation. In my tests using distributeOptions, the values I was trying to override were ignored.</p>
<p>I will close this JIRA and the associated PR as it's clear this situation is already addressed by Infusion.</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/KETTLE-61/"><span class="aria-hidden">←</span> Previous: KETTLE-61</a>
        <a class="mx-1" href="/browse/KETTLE-63/">Next: KETTLE-63 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>