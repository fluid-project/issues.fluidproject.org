<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-5906  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-5906 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-5906/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-5906/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-5906/">FLUID-5906</a></li>
            </ol>
        </nav>
        <h1>FLUID-5906: Improve fluid.require so that it can initiate module loading from the client's point of view</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-5906">FLUID-5906</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Improvement">Improvement</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2016-05-15T16:31:55.995-0400" prefix="">2016-05-15T16:31:55.995-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2016-07-08T09:08:53.436-0400" prefix="">2016-07-08T09:08:53.436-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Framework</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>Our "fluid.require" utility is capable of applying path-based interpolation to strings of the form "%kettle" etc in order to resolve paths relative to already-loaded modules. <a href="https://issues.gpii.net/browse/GPII-1795">https://issues.gpii.net/browse/GPII-1795</a> has exposed a case where we need to do more - we have a pair of modules which are cyclic with respect to each other's "devDependencies" (although not in terms of plain dependencies) - gpii-express makes use of kettle for request fixtures, and kettle makes use of gpii-pouchdb, which depends on gpii-express, in order to operate its CouchDB-semantic DataSource URL tests.</p>
<p>The fix initially suggested on <a href="https://issues.gpii.net/browse/GPII-1795">https://issues.gpii.net/browse/GPII-1795</a>, of replacing a statement in gpii-express reading <code>require("kettle")</code> with <code>fluid.require("%kettle")</code>, fixes the situation from kettle's point of view but breaks gpii-express' own tests since this line cannot initiate loading of Kettle if it has not loaded.</p>
<p>It's time to bite the bullet and upgrade fluid.require to a fully-capable replacement for node's "require" - with none of the annoyance of having to supply "require" as a fallback argument.</p>
<p>We can do this via techniques such as these: <a href="http://stackoverflow.com/questions/16697791/nodejs-get-filename-of-caller-function">http://stackoverflow.com/questions/16697791/nodejs-get-filename-of-caller-function</a> </p>
<p>This is specific to V8 and conforms to an API documented here: <a href="https://github.com/v8/v8/wiki/Stack-Trace-API">https://github.com/v8/v8/wiki/Stack-Trace-API</a></p>
<p>Note that we need this facility anyway, to implement the functionality of our existing debugging API fluid.getCallerInfo <a href="https://github.com/fluid-project/infusion/blob/master/src/framework/core/js/FluidDebugging.js#L141">https://github.com/fluid-project/infusion/blob/master/src/framework/core/js/FluidDebugging.js#L141</a> on node.js. We'll make an API-compatible function and deal with the platform detection later.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-24197">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2016-05-20T11:00:17.325-0400">2016-05-20T11:00:17.325-0400</relative-time></i></p>
                        <p>Note that whilst npm 3 now features support for resolving cyclic groups of modules - see <a href="https://github.com/npm/npm/issues/2063">https://github.com/npm/npm/issues/2063</a> - we will continue with the node 4.x/npm 2.x ecosystem for a while. Also, for this particular case, we will likely always run into problems due to the lack of transitivity of the "devDependencies" model. We should also think about factoring Kettle into several smaller npm modules using the "monorepo" pattern.</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-5905/"><span class="aria-hidden">←</span> Previous: FLUID-5905</a>
        <a class="mx-1" href="/browse/FLUID-5907/">Next: FLUID-5907 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>