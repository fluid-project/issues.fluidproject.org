<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-5248  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-5248 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-5248/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-5248/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-5248/">FLUID-5248</a></li>
            </ol>
        </nav>
        <h1>FLUID-5248: fluid.transforms.arrayValue are failing when having nested expanders</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-5248">FLUID-5248</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Critical</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Open</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Kasper%20Galschiot%20Markus">Kasper Galschiot Markus</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2014-01-09T16:47:50.454-0500" prefix="">2014-01-09T16:47:50.454-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2016-02-22T19:28:19.115-0500" prefix="">2016-02-22T19:28:19.115-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Model Transformation System</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>fluid.transforms.arrayValue seem to have problems when having complex objects passed as inputs. It works fine when wrapping simple values in arrays, but when you attempt to pass it an input value that is a transformation that needs further expansion, it fails.</p>
<p>For example:<br>
A rule set of:</p>
<pre><code class="hljs language-javascript">{
            <span class="hljs-string">"b"</span>: {
                <span class="hljs-string">"transform"</span>: {
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"fluid.transforms.arrayValue"</span>,
                    <span class="hljs-string">"value"</span>: {
                        <span class="hljs-string">"transform"</span>: {
                            <span class="hljs-string">"outputPath"</span>: <span class="hljs-string">"value"</span>,
                            <span class="hljs-string">"type"</span>: <span class="hljs-string">"fluid.transforms.linearScale"</span>,
                            <span class="hljs-string">"value"</span>: <span class="hljs-number">5</span>,
                            <span class="hljs-string">"factor"</span>: <span class="hljs-number">0.1</span>
                        }
                    }
                }
            }
        }
</code></pre>
<p>yields:</p>
<pre><code class="hljs language-javascript">{
  <span class="hljs-string">"b"</span>: {
    <span class="hljs-string">"value"</span>: <span class="hljs-number">0.5</span>
  }
}
</code></pre>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-13437">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2014-01-09T18:52:24.795-0500">2014-01-09T18:52:24.795-0500</relative-time></i></p>
                        <p>Strictly speaking, by our current rules, this test case is invalid. As you may remember, we designed the system so that "each transformer EITHER outputs immediately to the document at its current path, OR it makes a return value". In this case, the extra layer of "value" wrapping causes the first rule to trigger - which implies that fluid.transforms.arrayValue gets no input, and so has no action, and so returns nothing. For the time being I've adjusted the test case so it at least tests something - that is, removing the layer of "value" produces b: [ 0.5 ] as expected, satisfying the terms of the headline JIRA that "arrayValue should work with a nested expander" - it does, but not in the case that expander tries to output to the document. We should probably leave this JIRA open in case we want to revisit our original design decision, but thankfully at least I think Justin's use case can be met by the fix which I have issued simultaneously for <a href="/browse/FLUID-5247/">FLUID-5247</a>.</p>

                    </li>
                    
                    <li id="comment-13439">
                        <p class="mb-0"><b>Kasper Galschiot Markus</b> <i>commented <relative-time datetime="2014-01-12T04:44:24.325-0500">2014-01-12T04:44:24.325-0500</relative-time></i></p>
                        <p>From a quick look at this, I think that in this case our model with ""each transformer EITHER outputs immediately to the document at its current path, OR it makes a return value" might still hold up. Our model relies on the output path being modified as we're going through the transformation tree. The problem is that this doesn't happen when hitting an arrayValue - instead that just transforms the value before returning it. I think a potential solution would be to, when we hit the arrayValue transformer, to modify the "outputPath" to denote that we're now in an array... I do have a creepy feeling though that this would force us to consider the arrayValue a forced outputter - always outputting to the document - but that might just be my brain on meltdown. </p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-5247/"><span class="aria-hidden">←</span> Previous: FLUID-5247</a>
        <a class="mx-1" href="/browse/FLUID-5249/">Next: FLUID-5249 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>