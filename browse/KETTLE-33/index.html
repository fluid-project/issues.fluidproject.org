<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> KETTLE-33  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" KETTLE-33 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/KETTLE-33/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/KETTLE-33/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/KETTLE" data-pagefind-filter="project">Kettle</a></li>
                <li><a href="/browse/KETTLE-33/">KETTLE-33</a></li>
            </ol>
        </nav>
        <h1>KETTLE-33: Error handling in Datasources and requests is faulty</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/KETTLE-33">KETTLE-33</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/KETTLE/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Resolved</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/KETTLE/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/KETTLE/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2015-08-05T09:55:20.077-0400" prefix="">2015-08-05T09:55:20.077-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2016-05-25T18:56:48.814-0400" prefix="">2016-05-25T18:56:48.814-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>0.1</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>There are two faults in Kettle's current error handling.</p>
<p>Firstly: in the http variant of the URL data source - there is no attempt to check the HTTP status code, and the returned promise always resolves rather than rejecting - and so straighforward relaying of dataSources onto HTTP servers fails to work:</p>
<p>gpii.deviceReporter["static"].get = function (requestProxy, deviceReporter) {<br>
var promise = deviceReporter.installedSolutionsDataSource.get();<br>
promise.then(function (solutions) {<br>
deviceReporter.fireResponse(requestProxy, solutions);<br>
}, function (err) {<br>
requestProxy.events.onError.fire(err.message);<br>
});<br>
};</p>
<p>Secondly, there is no guarding in the request resolution in request.js to account for the fact that the request may have already ended in error (from Infusion's point of view) before the response is written - see in request.js:</p>
<p>kettle.requests.request.http.ensureResCompleted = function (that) {<br>
// NOTE: This is here because any of these events can represent the<br>
// moment when the server is finished with the response.<br>
fluid.each(["close", "finish", "end", "error"], function addListener(event) {<br>
that.res.on(event, function eventListener() {<br>
that.events.onRequestEnd.fire();<br>
that.destroy();<br>
});<br>
});<br>
};</p>
<p>compare this with the corresponding guarding using fluid.isDestroyed in request.io.js</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-26162">
                        <p class="mb-0"><b>Kasper Galschiot Markus</b> <i>commented <relative-time datetime="2015-08-05T12:15:05.777-0400">2015-08-05T12:15:05.777-0400</relative-time></i></p>
                        <p>Commit with hotfix for part of this issue: <a href="https://github.com/fluid-project/kettle/pull/20">https://github.com/fluid-project/kettle/pull/20</a></p>

                    </li>
                    
                    <li id="comment-26163">
                        <p class="mb-0"><b>Colin Clark</b> <i>commented <relative-time datetime="2015-08-06T10:13:51.309-0400">2015-08-06T10:13:51.309-0400</relative-time></i></p>
                        <p>Reviewed and merged at ef796237b7b157df6837a970a8b798370ef14144.</p>

                    </li>
                    
                    <li id="comment-26164">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2015-08-06T13:29:29.031-0400">2015-08-06T13:29:29.031-0400</relative-time></i></p>
                        <p>We should keep this open until a more comprehensive fix with test cases arrives in the large branch</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/KETTLE-32/"><span class="aria-hidden">←</span> Previous: KETTLE-32</a>
        <a class="mx-1" href="/browse/KETTLE-34/">Next: KETTLE-34 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>