<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-5088  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-5088 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-5088/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-5088/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-5088/">FLUID-5088</a></li>
            </ol>
        </nav>
        <h1>FLUID-5088: Improve expansion pathway so that it provides better diagnostics as well as resistance to circular expansion</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-5088">FLUID-5088</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Improvement">Improvement</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Justin Obara</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2013-07-12T23:33:02.800-0400" prefix="">2013-07-12T23:33:02.800-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2014-03-03T11:43:30.275-0500" prefix="">2014-03-03T11:43:30.275-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>1.5</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>IoC System</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>During this week's development of the schema-aware UIOptions builder an unfortunate framework behaviour emerged which was difficult to debug. </p>
<p><a href="http://wiki.fluidproject.org/display/fluid/fluid-work+IRC+Logs-2013-07-09">http://wiki.fluidproject.org/display/fluid/fluid-work+IRC+Logs-2013-07-09</a></p>
<p>At the time of writing the definition being expanded looked as follows:</p>
<p>fluid.defaults("fluid.uiOptions.builder.enhancer", {<br>
gradeNames: ["autoInit", "fluid.viewComponent"],<br>
components: {<br>
store: {<br>
type: "fluid.globalSettingsStore"<br>
},<br>
enhancer: {<br>
type: "fluid.uiEnhancer",<br>
container: "body",<br>
options: {<br>
components: "{fluid.uiOptions.builder.enhancer}.options.auxSchema.enactors",</p>
<p>the resulting behaviour of the framework was misleading since it only provided the following diagnostic:</p>
<p>Tue Jul 09 2013 13:55:01 <a href="/browse/GMT-0600/">GMT-0600</a> (Mountain Standard Time):  </p>
<p>ASSERTION FAILED: Failed to resolve reference {uiEnhancer}.applier - could not match context with name uiEnhancer from component leaf Object { typeName="fluid.uiOptions.constructed", id="13z4bdwt-25", options={...}, more...}<br>
Fluid.js (line 287)<br>
Current activity:<br>
Fluid.js (line 287) while resolving context value {uiEnhancer}.applier<br>
Fluid.js (line 287) while constructing component of type fluid.uiOptions.constructed with arguments ["body"]</p>
<p>this provided at least some clue in the form of the reference that was being expanded, but was misleading in that it didn't provide the path in the component tree at which this message was held. This took some time to debug until it could be discovered that the reference was actually present in an unrelated piece of material - in fact inside the reference  auxSchema: "{that}.options.auxSchema", appeared material which contained raw IoC references including the errant {uiEnhancer}.applier which got inopportunely expanded out of context.</p>
<p>In practice the issue was resolved by putting an appropriate "noexpand" mergePolicy on the auxSchema, but it would be helpful if the framework gave more clues to the expanding reference location in these cases.</p>
<p>In fact, of the two ginger pathways, the "merging" pathway is better in this respect in that it keeps track of the full path segments to each configuration location during the process, leading to the expected benefits in diagnostics - the mergeStrategy begins with the following guard:</p>
<p>var strategy = function (target, name, i, segs, sources, policy) {<br>
if (i &gt; fluid.strategyRecursionBailout) {<br>
fluid.fail("Overflow/circularity in options merging, current path is ", segs, " at depth " , i, " - please protect components from merging using the \"nomerge\" merge policy");<br>
}</p>
<p>the expand pathway in FluidIoC.js is underimplemented by comparison - perhaps as an optimisation we so far chose not to construct path segments in the case of "dispatch to self" since they were not otherwise read in the method body.</p>
<p>FluidIoC.js lines 1767-1769 currently has the following:</p>
<p>else { // Don't bother to generate segs or i in direct dispatch to self!!!!!!<br>
options.strategy(target, key, null, null, source, mergePolicy, miniWorld);<br>
}</p>
<p>this should be improved (at slight extra CPU cost) to be up to the standards of the merging pathway.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-14932">
                        <p class="mb-0"><b>Michelle D'Souza</b> <i>commented <relative-time datetime="2013-08-15T16:53:50.178-0400">2013-08-15T16:53:50.178-0400</relative-time></i></p>
                        <p>Merged into project repo at 3223079c74ad3a2a20551def3f5a1880c42b98bc</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-5087/"><span class="aria-hidden">←</span> Previous: FLUID-5087</a>
        <a class="mx-1" href="/browse/FLUID-5089/">Next: FLUID-5089 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>