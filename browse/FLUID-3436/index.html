<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-3436  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-3436 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-3436/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-3436/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-3436/">FLUID-3436</a></li>
            </ol>
        </nav>
        <h1>FLUID-3436: Concurrent identical builds will cause a race condition that results in an error for everyone but the person whose build finishes first.</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-3436">FLUID-3436</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Blocker</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Laurel Williams</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Laurel%20Williams">Laurel Williams</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2009-12-16T15:09:20.000-0500" prefix="">2009-12-16T15:09:20.000-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2010-01-05T15:49:10.000-0500" prefix="">2010-01-05T15:49:10.000-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>1.2</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Infusion Builder</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>If more than one identical, uncached build is requested at roughly the same time, an error occurs for all users but the first. This is due to the fact that both processes try to update the cache, inserting a new cache record with the same primary key. Attempts to do this subsequent to the first one will violate the unique constraint for this table in MySQL.</p>
<p>We can fix this by recognizing when a cache insert error occurs and actually checking the cache for the appropriate files, rather than just throwing an error.</p>
<p>Bug Parade Builder 1.1.2</p>

            </div>
            
            
            
            <div class="spacing-y-1">
                <h2>Attachments</h2>
                <ul class="spacing-y-1" role="list">
                    
                    <li>
                        <a href="https://idrc.cachefly.net/issues.fluidproject.org/FLUID/FLUID-3436/FLUID-3436-1.patch.txt">
                            
                                FLUID-3436-1.patch.txt
                            
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://idrc.cachefly.net/issues.fluidproject.org/FLUID/FLUID-3436/FLUID-3436-2.patch.txt">
                            
                                FLUID-3436-2.patch.txt
                            
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://idrc.cachefly.net/issues.fluidproject.org/FLUID/FLUID-3436/FLUID-3436-3.patch.txt">
                            
                                FLUID-3436-3.patch.txt
                            
                        </a>
                    </li>
                    
                </ul>
            </div>
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-23288">
                        <p class="mb-0"><b>Justin Obara</b> <i>commented <relative-time datetime="2009-12-18T16:06:05.000-0500">2009-12-18T16:06:05.000-0500</relative-time></i></p>
                        <p>Bug Parade Builder 1.1.2</p>

                    </li>
                    
                    <li id="comment-23289">
                        <p class="mb-0"><b>Laurel Williams</b> <i>commented <relative-time datetime="2010-01-04T11:03:07.000-0500">2010-01-04T11:03:07.000-0500</relative-time></i></p>
                        <p>The attached patch <a href="/browse/FLUID-3436/">FLUID-3436</a>-1.patch.txt should solve the problem. It follows up a failed cache insert with a check that the requested build had already been cached. If the cached item exists then the processing continues as expected. Otherwise a failure is thrown as before.</p>
<p>I've tested this briefly by bypassing the code which initially checks for caching, but this needs to be applied and tested properly with several concurrent users in the same way we did before.</p>

                    </li>
                    
                    <li id="comment-23290">
                        <p class="mb-0"><b>Laurel Williams</b> <i>commented <relative-time datetime="2010-01-04T14:57:59.000-0500">2010-01-04T14:57:59.000-0500</relative-time></i></p>
                        <p>I moved the code into a separate function which returns true or false if the file is cached or not cached. The function is longer than the mysql query in the previous patch. The function fails if the mysql query results in an error and then ensures that the successful query returns a row of data. I also changed the names of the variables in the existing code to be a little more descriptive (ie. $is_cached rather than $cached_row). </p>

                    </li>
                    
                    <li id="comment-23291">
                        <p class="mb-0"><b>Justin Obara</b> <i>commented <relative-time datetime="2010-01-04T16:41:42.000-0500">2010-01-04T16:41:42.000-0500</relative-time></i></p>
                        <p>I walked through the code with Laurel, it looks good. I only recommended changing the name of the $cached_rows variable.</p>

                    </li>
                    
                    <li id="comment-23292">
                        <p class="mb-0"><b>Laurel Williams</b> <i>commented <relative-time datetime="2010-01-05T12:20:04.000-0500">2010-01-05T12:20:04.000-0500</relative-time></i></p>
                        <p>Made a small change to the variable names in the function as per Justin's suggestion, and fixed a spelling error in the error message.</p>

                    </li>
                    
                    <li id="comment-23293">
                        <p class="mb-0"><b>Colin Clark</b> <i>commented <relative-time datetime="2010-01-05T15:47:22.000-0500">2010-01-05T15:47:22.000-0500</relative-time></i></p>
                        <p>I've reviewed Laurel's third patch to this issue and it looks good. Committed at r8952.</p>

                    </li>
                    
                    <li id="comment-23294">
                        <p class="mb-0"><b>Colin Clark</b> <i>commented <relative-time datetime="2010-01-05T15:49:10.000-0500">2010-01-05T15:49:10.000-0500</relative-time></i></p>
                        <p>This one is cool for the 1.1.2.1 release of Builder.</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-3435/"><span class="aria-hidden">←</span> Previous: FLUID-3435</a>
        <a class="mx-1" href="/browse/FLUID-3437/">Next: FLUID-3437 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>