<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-6100  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-6100 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-6100/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-6100/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-6100/">FLUID-6100</a></li>
            </ol>
        </nav>
        <h1>FLUID-6100: It's inconvenient to not be able to use IoC expressions in a "modules" block of a testCaseHolder</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-6100">FLUID-6100</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Improvement">Improvement</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Open</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Colin%20Clark">Colin Clark</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2016-12-18T12:29:24.564-0500" prefix="">2016-12-18T12:29:24.564-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2016-12-18T21:46:14.296-0500" prefix="">2016-12-18T21:46:14.296-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>IoC Testing Framework</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>At the moment, fluid.test.testCaseHolder declares a mergePolicy of "noexpand" for its "modules" option. Presumably this is because it operates its own custom (late) lifecycle for the contents of the "modules" structure, but it also means that seemingly-innocent IoC expressions fail to work. As a user from the outside, this seems confusingly inconsistent with most other components where IoC expressions can be used freely anywhere within an options structure. If nothing else, this might suggest a documentation opportunity where we could establish a convention for marking regions of a components options that have special mergePolicies.</p>
<p>Here are a couple of examples of things I tried while learning the IoC Testing framework, which didn't work:</p>
<pre><code class="hljs language-javascript">fluid.<span class="hljs-title function_">defaults</span>(<span class="hljs-string">"flock.test.lessPointyTester"</span>, {
    <span class="hljs-attr">gradeNames</span>: <span class="hljs-string">"fluid.test.testCaseHolder,

    testSequence: [
        {
            func: "</span><span class="hljs-title class_">QUnit</span>.<span class="hljs-property">ok</span><span class="hljs-string">",
            args: [true]
        }
    ],

    modules: [
        {
            name: "</span>A <span class="hljs-variable language_">module</span><span class="hljs-string">",
            tests: [
                {
                     name: "</span><span class="hljs-title class_">Some</span> test<span class="hljs-string">",
                     expect: 1,
                     // This fails because the testing framework tries to iterate over the raw string
                     // as if it were an array of sequence specifications.
                     sequence: "</span>{that}.<span class="hljs-property">options</span>.<span class="hljs-property">testSequence</span><span class="hljs-string">" 
                }
            ]
        }
    ]
});
</span></code></pre>
<pre><code class="hljs language-javascript">fluid.<span class="hljs-title function_">defaults</span>(<span class="hljs-string">"flock.test.bus.tester"</span>, {
        <span class="hljs-attr">gradeNames</span>: <span class="hljs-string">"fluid.test.testCaseHolder"</span>,

        <span class="hljs-attr">modules</span>: [
            {
                <span class="hljs-comment">// Here, obviously, when I use this a base grade all my modules end up</span>
                <span class="hljs-comment">// with the name of the literal string "{that}.options.moduleName"</span>
                <span class="hljs-attr">name</span>: <span class="hljs-string">"{that}.options.moduleName"</span>,
                <span class="hljs-attr">tests</span>: [
                    {
                        <span class="hljs-attr">name</span>: <span class="hljs-string">"Acquire too many buses"</span>,
                        <span class="hljs-attr">expect</span>: <span class="hljs-number">3</span>,
                        <span class="hljs-attr">sequence</span>: [
                            {
                                <span class="hljs-attr">funcName</span>: <span class="hljs-string">"flock.test.bus.runTests"</span>,
                                <span class="hljs-attr">args</span>: [
                                    <span class="hljs-string">"{environment}"</span>,
                                    <span class="hljs-string">"{that}.options.busType"</span>,
                                    <span class="hljs-string">"{that}.options.numBusesToAcquire"</span>,
                                    <span class="hljs-string">"{that}.expectedBusIndex"</span>
                                ]
                            }
                        ]
                    }
                ]
            }
        ],

        <span class="hljs-attr">invokers</span>: {
            <span class="hljs-attr">expectedBusIndex</span>: {
                <span class="hljs-attr">funcName</span>: <span class="hljs-string">"fluid.notImplemented"</span>
            }
        }
    });
</code></pre>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-13310">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2016-12-18T19:00:13.107-0500">2016-12-18T19:00:13.107-0500</relative-time></i></p>
                        <p>Hi - thanks for this report which highlights an annoying usability failure. This looks like a great use case for the new "sequenceGrade" option which is currently in trunk, but whose documentation is in review: <a href="https://github.com/amb26/infusion-docs/blob/FLUID-5903/src/documents/IoCTestingFramework.md#using-sequencegrade-to-build-up-complex-reusable-test-sequences">https://github.com/amb26/infusion-docs/blob/FLUID-5903/src/documents/IoCTestingFramework.md#using-sequencegrade-to-build-up-complex-reusable-test-sequences</a> - in keeping with our modern tendency towards creating "gigantic up-front JSON dialects" (like renderer component trees, model transformation documents and IoC Testing fixtures), this allows the work of building up a test sequence to be factored out as a set of reusable grades, which each feature a less hostile mergePolicy.<br>
There was also extensive notes taken in the piratePad in the GPII meeting on this topic last Monday but sadly I can't easily find the URL at present.</p>
<p>In terms of fixing the existing "modules" feature I fear there is little we can do with the existing framework architecture since it would require a level of detailed control over mergePolicies which isn't currently possible - and which I suspect might create a confusing landscape if it was possible.</p>

                    </li>
                    
                    <li id="comment-13311">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2016-12-18T21:46:14.296-0500">2016-12-18T21:46:14.296-0500</relative-time></i></p>
                        <p>I've wikified the notes from the relevant section of the meeting at <a href="https://wiki.fluidproject.org/display/fluid/Motivation+and+Explanation+for+New+IoC+Testing+Framework+Feature+sequenceGrade">https://wiki.fluidproject.org/display/fluid/Motivation+and+Explanation+for+New+IoC+Testing+Framework+Feature+sequenceGrade</a></p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-6099/"><span class="aria-hidden">←</span> Previous: FLUID-6099</a>
        <a class="mx-1" href="/browse/FLUID-6101/">Next: FLUID-6101 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>