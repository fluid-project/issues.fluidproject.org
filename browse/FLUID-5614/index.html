<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-5614  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-5614 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-5614/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-5614/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-5614/">FLUID-5614</a></li>
            </ol>
        </nav>
        <h1>FLUID-5614: Options merging process is faulty in the case of "double deep trees"</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-5614">FLUID-5614</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2015-04-05T15:49:09.664-0400" prefix="">2015-04-05T15:49:09.664-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2024-07-22T10:35:28.126-0400" prefix="">2024-07-22T10:35:28.126-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>2.0</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>4.0</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Framework</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p><a href="/browse/FLUID-5249/">FLUID-5249</a> work kicked up the observation that our options merging implementation is faulty when grades are merged containing multiple representations of "deep trees" - because our support for mergePolicies cannot see into the "components" area and we do not store their contents in an appropriate way when merging.</p>
<p>For example, in the case where we have</p>
<pre><code class="hljs language-java">fluid.defaults(<span class="hljs-string">"gradeA"</span>, {
    components: {
        sub: {
            gradeNames: <span class="hljs-string">"gradeC"</span>
         }
    }
</code></pre>
<p>and </p>
<pre><code class="hljs language-java">fluid.defaults(<span class="hljs-string">"gradeB"</span>, {
    gradeNames: <span class="hljs-string">"gradeA"</span>,
    components: {
        sub: {
            gradeNames: <span class="hljs-string">"gradeD"</span>
         }
    }
}
</code></pre>
<p>we then end up with the subcomponent grade of "gradeC" eliminated completely from gradeB's tree rather than merging additively as one would expect. This is because we don't have any appropriate representation for the "superposition of deep trees" that would allow the normal grade merging algorithm for "sub" to apply the proper merge policy to its grades when it comes to resolve. This is a pretty serious fault that will end up upsetting someone before long. The workaround is to ensure that we only attempt such "deep" definitions along a single path in the grade hierarchy, which in the end is going to end up excluding some valid designs.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-25178">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2015-05-22T13:49:38.550-0400">2015-05-22T13:49:38.550-0400</relative-time></i></p>
                        <p>It appears that this bug is more basic and threatening than was first thought - it seems capable of corrupting even plain options definitions that appear along two different paths through "deep trees" - see discussion in IRC at <a href="https://botbot.me/freenode/fluid-work/2015-05-22/?msg=39911542&page=1">https://botbot.me/freenode/fluid-work/2015-05-22/?msg=39911542&amp;page=1</a></p>

                    </li>
                    
                    <li id="comment-25179">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2016-01-29T16:49:23.675-0500">2016-01-29T16:49:23.675-0500</relative-time></i></p>
                        <p>A use case of a failure with broadcasting "deep trees" options: <a href="https://github.com/cindyli/universal/tree/GPII-1521-distributeOptions">https://github.com/cindyli/universal/tree/GPII-1521-distributeOptions</a></p>
<p>The distributeOptions target in question: <a href="https://github.com/cindyli/universal/blob/GPII-1521-distributeOptions/gpii/node_modules/preferencesServer/src/preferencesServer.js#L105">https://github.com/cindyli/universal/blob/GPII-1521-distributeOptions/gpii/node_modules/preferencesServer/src/preferencesServer.js#L105</a></p>
<p>To produce the failure:<br>
1. Use the new universal with node 4.2.1<br>
2. Start GPII with the config file "preferencesServer.development.all.local"</p>
<pre><code class="hljs language-java">NODE_ENV=preferencesServer.development.all.local node gpii.js
</code></pre>
<p>3. This error is thrown:</p>
<pre><code class="hljs language-java">Error in invoker record: could not resolve members func, funcName or method to a function implementation - got undefined from {
    <span class="hljs-string">"func"</span>: <span class="hljs-string">"{dataStore}.findAuthorizedClientsByUserId"</span>,
    <span class="hljs-string">"funcName"</span>: undefined,
    <span class="hljs-string">"listener"</span>: undefined,
    <span class="hljs-string">"this"</span>: undefined,
    <span class="hljs-string">"method"</span>: undefined,
    <span class="hljs-string">"componentSource"</span>: <span class="hljs-string">"gpii.oauth2.authorizationService"</span>
}
</code></pre>
<p>The error was due to "inMemoryDataStore" that's constructed at preferencesServer.js, line 96 is not distributed to the target.</p>
<p>Currently, switching the target to use line 106 fixes the issue.</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-5613/"><span class="aria-hidden">←</span> Previous: FLUID-5613</a>
        <a class="mx-1" href="/browse/FLUID-5615/">Next: FLUID-5615 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>