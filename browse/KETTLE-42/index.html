<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> KETTLE-42  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" KETTLE-42 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/KETTLE-42/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/KETTLE-42/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/KETTLE" data-pagefind-filter="project">Kettle</a></li>
                <li><a href="/browse/KETTLE-42/">KETTLE-42</a></li>
            </ol>
        </nav>
        <h1>KETTLE-42: Protect File dataSources against relative path resolution</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/KETTLE-42">KETTLE-42</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/KETTLE/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Open</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/KETTLE/?reporter=Simon%20Bates">Simon Bates</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2016-05-06T09:32:20.241-0400" prefix="">2016-05-06T09:32:20.241-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2016-05-06T09:34:25.214-0400" prefix="">2016-05-06T09:34:25.214-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>The kettle.dataSource.file grade does not currently protect against path terms containing relative path characters.</p>
<p>The risk is that if an application exposed file dataSource terms in a publicly accessible way (such as through an HTTP endpoint), an attacker could cause the application to access files outside of the application's directory on the filesystem. For read-only dataSources, an attacker could cause the application to read any file that the application has access to, such as application or system configuration. For writable dataSources, an attacker could also cause the application to write to the filesystem.</p>
<p>The URL varieties of the dataSource do URI encoding when populating the url from the termMap.</p>
<p>Some options for file dataSources:</p>
<ul>
<li>do escaping/encoding for file paths in a similar manner to that done for URL dataSources (some research would be necessary here to see if this can be done in a cross- operating system / filesystem manner)</li>
<li>test the terms before populating the path and reject any that have relative paths in them</li>
</ul>
<p>Proof of concept code showing access outside of an application's directory:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> fluid = <span class="hljs-built_in">require</span>(<span class="hljs-string">"infusion"</span>),
    kettle = <span class="hljs-built_in">require</span>(<span class="hljs-string">"kettle"</span>),
    tests = fluid.<span class="hljs-title function_">registerNamespace</span>(<span class="hljs-string">"tests"</span>);

fluid.<span class="hljs-title function_">defaults</span>(<span class="hljs-string">"tests.testRelativeFileDataSource"</span>, {
    <span class="hljs-attr">gradeNames</span>: <span class="hljs-string">"kettle.dataSource.file"</span>,
    <span class="hljs-attr">path</span>: <span class="hljs-string">"/home/simon/idrc/test-kettle-relative-file-dataSource/%filename"</span>,
    <span class="hljs-attr">termMap</span>: {
        <span class="hljs-attr">filename</span>: <span class="hljs-string">"%filename"</span>
    },
    <span class="hljs-attr">components</span>: {
        <span class="hljs-attr">encoding</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"kettle.dataSource.encoding.none"</span>
        }
    }
});

<span class="hljs-keyword">var</span> myDataSource = tests.<span class="hljs-title function_">testRelativeFileDataSource</span>();
<span class="hljs-keyword">var</span> promise = myDataSource.<span class="hljs-title function_">get</span>({<span class="hljs-attr">filename</span>: <span class="hljs-string">"../hi.txt"</span>});

promise.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Got dataSource response of "</span>, response);
}, <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Got dataSource error response of "</span>, error);
});
</code></pre>

            </div>
            
            
            
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/KETTLE-41/"><span class="aria-hidden">←</span> Previous: KETTLE-41</a>
        <a class="mx-1" href="/browse/KETTLE-43/">Next: KETTLE-43 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>