<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-5559  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-5559 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-5559/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-5559/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-5559/">FLUID-5559</a></li>
            </ol>
        </nav>
        <h1>FLUID-5559: onTestCaseStart event can fire multiple times in IoC Testing fixture</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-5559">FLUID-5559</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2014-11-18T14:41:18.553-0500" prefix="">2014-11-18T14:41:18.553-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2014-11-19T10:29:24.687-0500" prefix="">2014-11-19T10:29:24.687-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>1.5</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>IoC Testing Framework</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>As part of the <a href="/browse/FLUID-4929/">FLUID-4929</a> fix we introduced an event intrinsic to an IoC Testing framework fixture, "onTestCaseStart", which allows the timing of component construction to be "caught" by the beginning of a fixture sequence - the typical use of this is via a createOnEvent: "onTestCaseStart" directive. An implementation bug allows this event to fire twice for the same sequence if the listener to initial firing synchronously causes control to pass to the final element of the sequence. This event was implemented lazily using two firing sites and guarded by a flag whose setting was mistimed.</p>
<p>This arose during work on the preference editing framework - <a href="https://github.com/cindyli/prefsEditors/blob/GPII-1014/tests/adjusters/js/cursorSizePCPTests.js#L106-L107">https://github.com/cindyli/prefsEditors/blob/GPII-1014/tests/adjusters/js/cursorSizePCPTests.js#L106-L107</a> held</p>
<p>sequence: [{<br>
listener: "gpii.tests.cursorSizePCPTests.testDefault",<br>
priority: "last",<br>
event: "{cursorSizePCPTests cursorSizePCP}.events.afterRender"<br>
}, {<br>
func: "gpii.tests.cursorSizePCPTests.pressStepper",<br>
args: ["{cursorSizePCP}"]<br>
}]</p>
<p>where the corresponding environment was defined as</p>
<p>fluid.defaults("gpii.tests.cursorSizePCPTests", {<br>
gradeNames: ["fluid.test.testEnvironment", "autoInit"],<br>
components: {<br>
cursorSizePCP: {<br>
type: "gpii.adjuster.cursorSizePCP",<br>
container: ".gpiic-cursorSizePCP",<br>
createOnEvent: "{cursorSizePCPTester}.events.onTestCaseStart",</p>
<p>the framework passes via its "makeBinder" directly from the listener to sequence point 0 to point 1, triggering the re-construction of the "cursorSizePCP" component before its first construction has finished. There's probably a strong case for introducing asynchrony between all transitions in these test case fixtures, since the behaviour of the framework on re-initiating construction or destruction during either construction or destruction is undefined. These conditions should also receive explicit diagnostics - although these wouldn't have done a much better job in trapping and explaining the current issue than the one we already have.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-23636">
                        <p class="mb-0"><b>Cindy Li</b> <i>commented <relative-time datetime="2014-11-19T10:29:20.949-0500">2014-11-19T10:29:20.949-0500</relative-time></i></p>
                        <p>Antranig's pull request (<a href="https://github.com/fluid-project/infusion/pull/570">https://github.com/fluid-project/infusion/pull/570</a>) that fixes this issue has been merged into the project repo @ f5d4f6ac978fe235baf0986b56edd7af6c0bd452</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-5558/"><span class="aria-hidden">←</span> Previous: FLUID-5558</a>
        <a class="mx-1" href="/browse/FLUID-5560/">Next: FLUID-5560 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>