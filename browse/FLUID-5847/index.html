<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-5847  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-5847 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-5847/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-5847/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-5847/">FLUID-5847</a></li>
            </ol>
        </nav>
        <h1>FLUID-5847: Model relay fails to operate for rule which has both transform model dependency and source</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-5847">FLUID-5847</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2016-01-22T21:08:52.089-0500" prefix="">2016-01-22T21:08:52.089-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2019-07-12T09:15:10.071-0400" prefix="">2019-07-12T09:15:10.071-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>2.0</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Data Binder</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>A relay rule of the following form fails to operate when its data is invalidated - </p>
<pre><code class="hljs language-java">modelRelay: {
        source: <span class="hljs-string">"dataRange.step"</span>,
        target: <span class="hljs-string">"position"</span>,
        singleTransform: {
            type: <span class="hljs-string">"souq.rescalePosition"</span>,
            dataRange: <span class="hljs-string">"{that}.model.dataRange"</span>
        }
    },
</code></pre>
<p>This is because the relay parser is geared up to expect EITHER relays with data dependencies in their transforms, OR a source entry, not both. The relay machinery embodies this assumption in the crazy pathway which updates a relay document rule with a "newValue" of "undefined" - currently at DataBinding.js line 506:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> This is just for safety but is still unusual and now abused. The transducer doesn't need the "newValue" since all the transform information</span>
                    <span class="hljs-comment">// has been baked into the transform document itself. However, we now rely on this special signalling value to make sure we regenerate transforms in</span>
                    <span class="hljs-comment">// the "forwardAdapter"</span>
                    <span class="hljs-title function_">transducer</span>(existing.<span class="hljs-property">transaction</span>, options.<span class="hljs-property">sourceApplier</span> ? <span class="hljs-literal">undefined</span> : newValue, sourceSegs, targetSegs);
</code></pre>
<p>At the very least we need to signal that writing such transforms is an error. They fail to operate since an source value of "undefined" when operating the transform culls it out. I recall that a hack we have tended to use is to manually apply an input value of "true" but obviously this is completely unsatisfactory - especially in the current case where we actually want the input value explicitly.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-24300">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2016-09-22T22:40:13.185-0400">2016-09-22T22:40:13.185-0400</relative-time></i></p>
                        <p>Merged into trunk at revision 94fdce728416f1b38f0181c4fa32bcae347acdbd on March 4th 2016</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-5846/"><span class="aria-hidden">←</span> Previous: FLUID-5846</a>
        <a class="mx-1" href="/browse/FLUID-5848/">Next: FLUID-5848 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>