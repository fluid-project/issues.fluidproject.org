<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> SJRK-369  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" SJRK-369 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/SJRK-369/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/SJRK-369/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/SJRK" data-pagefind-filter="project">Social Justice Repair Kit</a></li>
                <li><a href="/browse/SJRK-369/">SJRK-369</a></li>
            </ol>
        </nav>
        <h1>SJRK-369: Solve potential reorderer race condition on block addition</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/SJRK-369">SJRK-369</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/SJRK/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Open</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>N/A</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/SJRK/?reporter=Gregor%20Moss">Gregor Moss</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2020-06-25T22:21:19.781-0400" prefix="">2020-06-25T22:21:19.781-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2021-07-14T10:03:04.197-0400" prefix="">2021-07-14T10:03:04.197-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Storytelling Tool UI</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>The introduction of the reorderer component in the storyEditor grade brought along with it the potential for a race condition whenever new blocks are added.</p>
<p>Ideally, we would like the reorderer to call its "refresh" invoker any time a new block is added, but if this is called while many blocks are being added simultaneously, errors will occur and break the page.</p>
<p>The temporary solution is to delay calling "refresh" until any block has focus, but this results in many superfluous calls to refresh along with subsequent activation of various model relays and listeners related to autosave. These aren't harmful per se (yet), but they do waste cycles and the solution is inelegant and somewhat obscure.</p>
<p>A better solution (proposed by Justin Obara) would be to implement a sort of event queue which, when a block is added:</p>
<ol>
<li>enqueues (pushes) an object&#160;containing the args of the viewComponentContainerRequested event and whatever else is needed for queue management (maybe nothing),</li>
<li>fires the event, passing the args,</li>
<li>dequeues (shifts) the object when the block fires its onTemplateRendered event, and finally</li>
<li>calls refresh once the queue is empty (when length === 0)</li>
</ol>
<p>This solution may also require disabling adding new blocks while the refresh is underway (perhaps with a model value and associated listeners), otherwise the race condition is still present.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-26332">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2021-07-14T10:03:04.197-0400">2021-07-14T10:03:04.197-0400</relative-time></i></p>
                        <p>Would it be possible to get some more details on this issue, or possibly some sample code which causes the problem? What kind of pattern is being used during the activity "this is called while many blocks are being added simultaneously", and what kinds of errors result?</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/SJRK-368/"><span class="aria-hidden">←</span> Previous: SJRK-368</a>
        <a class="mx-1" href="/browse/SJRK-370/">Next: SJRK-370 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>