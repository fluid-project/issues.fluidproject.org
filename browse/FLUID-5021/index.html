<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-5021  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-5021 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-5021/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-5021/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-5021/">FLUID-5021</a></li>
            </ol>
        </nav>
        <h1>FLUID-5021: Clarify relationship of "noexpand", "nomerge" and "replace" mergePolicies</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-5021">FLUID-5021</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Improvement">Improvement</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Open</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2013-05-19T03:01:25.531-0400" prefix="">2013-05-19T03:01:25.531-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2015-06-15T10:24:45.610-0400" prefix="">2015-06-15T10:24:45.610-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>1.4</li>
                            
                            <li>1.5</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Framework</li>
                            
                            <li>IoC System</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>The current behaviour of the "nomerge" mergePolicy is unintuitive. Since the implementation of <a href="/browse/FLUID-4330/">FLUID-4330</a> ginger expansion, the expansion process for component options now obligatorily copies options material as it expands, unless it is advised not to by one of the mergePolicies that it understands. Currently these mergePolicies are "noexpand" and "preserve".</p>
<p>Ignoring for the time being the oddity of having things named "mergePolicies" which are in fact directed at the expansion process, we need to rationalise the behaviour of "nomerge" since the default expectation by a user unfamiliar to the framework is that "nomerge" will leave the options material it is applied to completely untouched. The recent example was of a Float32Array which was being corrupted by the options expansion process, even when "nomerge" was applied. No single mergePolicy was capable of preserving this material, which in fact required the combination of "nomerge, noexpand". The best solution here was to reposition the material as a "member" rather than a piece of the options material but we still need to avoid confounding users in this case.</p>
<p><a href="/browse/FLUID-4706/">FLUID-4706</a> is relevant to this issue, and describes an uncoupling in the opposite direction. While, historically, it seems that "noexpand" used to imply "nomerge", it seems that what we now need post-<a href="/browse/FLUID-4330/">FLUID-4330</a> is a "nomerge" that implies "noexpand". It should be possible to position the "replace" mergePolicy as the suitable option for those who DO want expansion but no merging - especially since it has custom short-circuit support within the merging algorithm to avoid costly expansion of references which it can be known will be discarded moving from left to right - it in fact picks the rightmost value of a set of merging values and only dispatches calls into the underlying strategy for that value.</p>

            </div>
            
            
            
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-5020/"><span class="aria-hidden">←</span> Previous: FLUID-5020</a>
        <a class="mx-1" href="/browse/FLUID-5022/">Next: FLUID-5022 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>