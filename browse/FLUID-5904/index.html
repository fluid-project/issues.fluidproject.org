<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> FLUID-5904  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" FLUID-5904 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/FLUID-5904/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/FLUID-5904/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/FLUID" data-pagefind-filter="project">Fluid Infusion</a></li>
                <li><a href="/browse/FLUID-5904/">FLUID-5904</a></li>
            </ol>
        </nav>
        <h1>FLUID-5904: Component which throws exception triggering self-destruction during creation will fail during cleanup</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/FLUID-5904">FLUID-5904</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/FLUID/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/FLUID/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>Antranig Basman</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/FLUID/?reporter=Antranig%20Basman">Antranig Basman</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2016-05-09T20:28:53.942-0400" prefix="">2016-05-09T20:28:53.942-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2016-05-11T11:22:25.546-0400" prefix="">2016-05-11T11:22:25.546-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>2.0</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>IoC System</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>A component which throws an exception before its events are constructed - for example, from an expander which is used to initialise an option - will be left in a condition which cannot properly go through the cleanup lifecycle of "doDestroy" since the line that.events.onDestroy.fire() in fluid.doDestroy (currently Fluid.js line 2597) references a nonexistent event.</p>
<p>This was discovered whilst testing Kettle's "static middleware" error handling, which appears like this:</p>
<pre><code class="hljs language-javascript">fluid.<span class="hljs-title function_">defaults</span>(<span class="hljs-string">"kettle.middleware.static"</span>, {
    <span class="hljs-attr">gradeNames</span>: [<span class="hljs-string">"kettle.plainMiddleware"</span>],
...
    <span class="hljs-comment">// Remember that we write this kind of rubbish because of the crummy pre-<a href="/browse/FLUID-4982/">FLUID-4982</a> ginger world</span>
    <span class="hljs-attr">middleware</span>: <span class="hljs-string">"@expand:kettle.middleware.static.createMiddleware({that}.options.root, {that}.options.terms, {that}.options.middlewareOptions)"</span>
});

kettle.<span class="hljs-property">middleware</span>[<span class="hljs-string">"static"</span>].<span class="hljs-property">createMiddleware</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">root, terms, middlewareOptions</span>) {
    <span class="hljs-keyword">if</span> (!root) {
        fluid.<span class="hljs-title function_">fail</span>(<span class="hljs-string">"Static middleware must have a root path configured to serve options - got "</span>, root);
    }
...
};
</code></pre>
<p>This is a class of error we will have to be particularly aggressive at tackling in the post <a href="/browse/FLUID-4982/">FLUID-4982</a> world where component construction will have to be fully transactional and Nexus-ready.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-24177">
                        <p class="mb-0"><b>Antranig Basman</b> <i>commented <relative-time datetime="2016-05-09T20:46:45.740-0400">2016-05-09T20:46:45.740-0400</relative-time></i></p>
                        <p>This is actually a regression since in commit <a href="https://github.com/fluid-project/infusion/commit/0bfd51b310d7c10f01104460f09a00f40bd9d98b#diff-eb23eba7203e400016bc578a4faf8ddb">https://github.com/fluid-project/infusion/commit/0bfd51b310d7c10f01104460f09a00f40bd9d98b#diff-eb23eba7203e400016bc578a4faf8ddb</a> of Aug 7, 2015 we removed the utility "fluid.fireEvent" as part of "General tidying" which used to give us resistance to such problems (it was previously classed as an "optimisation" for firing to uninstantiated lifecycle events which had no listeners, of which we no longer legitimately have/had any)</p>

                    </li>
                    
                    <li id="comment-24179">
                        <p class="mb-0"><b>Justin Obara</b> <i>commented <relative-time datetime="2016-05-11T11:22:19.646-0400">2016-05-11T11:22:19.646-0400</relative-time></i></p>
                        <p>Merged pull request ( <a href="https://github.com/fluid-project/infusion/pull/711">https://github.com/fluid-project/infusion/pull/711</a> ) into the project repo at 78d75841a6d6305b11f3ac8ca1b2b66fc67e4c22</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/FLUID-5903/"><span class="aria-hidden">←</span> Previous: FLUID-5903</a>
        <a class="mx-1" href="/browse/FLUID-5905/">Next: FLUID-5905 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>