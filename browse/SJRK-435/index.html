<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> SJRK-435  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" SJRK-435 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/SJRK-435/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/SJRK-435/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/SJRK" data-pagefind-filter="project">Social Justice Repair Kit</a></li>
                <li><a href="/browse/SJRK-435/">SJRK-435</a></li>
            </ol>
        </nav>
        <h1>SJRK-435: Table of Contents link on Edit page goes to story preview</h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/SJRK-435">SJRK-435</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/SJRK/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/SJRK/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>N/A</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/SJRK/?reporter=Gregor%20Moss">Gregor Moss</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2020-12-03T17:39:02.705-0500" prefix="">2020-12-03T17:39:02.705-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2021-01-12T10:09:04.851-0500" prefix="">2021-01-12T10:09:04.851-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>0.5</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>When the UIO "Table of Contents" preference is activated after loading the Story Edit page, the link will take the author to the story preview. This also bypasses the updating of the preview step, so it will show whatever was current in the story model the last time the author clicked on "Preview my story" on the metadata step.</p>
<p>The solution may involve looking into the Tool's usage of <a href="https://github.com/fluid-project/fluid-location-bar-relay">fluid-location-bar-relay</a> for browser history management, as that affects the address bar, and vice versa. UIO's ToC enactor will generate a link and anchor for each h1 heading on the page which, when clicked, will modify the page URL to go to the anchor, adding a new history state to the "fluid.locationBar" component and interfering with the Edit page's visibility state model values.</p>
<p><strong>To reproduce:</strong><br>
1. Go to <a href="https://staging-stories.floeproject.org/storyEdit.html">https://staging-stories.floeproject.org/storyEdit.html</a><br>
2. Click "+ show preferences" at the top-right corner<br>
3. On the "table of contents" preference, click the toggle to set it to "ON"</p>
<p><em>Note: If the preference was set to "ON" when the page loaded, you must set it to "OFF", reload the page and follow the steps anew.</em></p>
<p><strong>Expected:</strong><br>
Unsure, requires some design iteration. The table of contents probably shouldn't be shown on this page, or perhaps it could show a summary of blocks, and the links would go to each block within the editor.</p>
<p><strong>Actual:</strong><br>
The story preview is shown, potentially showing an outdated preview (as described above).</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-26625">
                        <p class="mb-0"><b>Gregor Moss</b> <i>commented <relative-time datetime="2020-12-08T17:57:40.603-0500">2020-12-08T17:57:40.603-0500</relative-time></i></p>
                        <p>For the time being, the decision was made to hide the TOC on the Edit page at all times, circumventing the bug. This was done by adding a CSS rule to the Edit page's head which makes the TOC container element "display: none !important". Adding this rule to the TOC element inline would make the rule more specific (as inline styling has the highest specificity), but because <a href="https://github.com/fluid-project/infusion/blob/39773eb69938b6fa0bb9e3ae8f083775d2754f2f/src/framework/preferences/js/Enactors.js#L512-L522">the TOC enactor calls jQuery .show() and .hide()</a> the TOC gets shown when the preference is turned off and then on again (but not when it's turned on intially, apparently).</p>
<p>Various other approaches were considered and attempted, including:</p>
<ul>
<li>setting the model relay between the historian and page components to be one-way from the page to the historian only (this broke the historian's visibility-setting functionality)</li>
<li>turning off the TOC panel/preference for this page via overriding the UIO options in the Edit page grade (this would be better, but would take more time to implement than the chosen solution)</li>
<li>overriding the TOC template to a blank template (a bit hacky) or to no template (UIO raised errors when this was attempted)</li>
<li>modifying/updating fluid-location-bar-relay to configure it to be used the way the Storytelling Tool needs (this was considered only)</li>
</ul>

                    </li>
                    
                    <li id="comment-26626">
                        <p class="mb-0"><b>Justin Obara</b> <i>commented <relative-time datetime="2020-12-09T08:59:44.646-0500">2020-12-09T08:59:44.646-0500</relative-time></i></p>
                        <p>Merged PR ( <a href="https://github.com/fluid-project/sjrk-story-telling/pull/104">https://github.com/fluid-project/sjrk-story-telling/pull/104</a>&#160;) into the project repo at&#160;c52e54e2aed53540cae12718dba3c48e520a0eb4</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/SJRK-434/"><span class="aria-hidden">←</span> Previous: SJRK-434</a>
        <a class="mx-1" href="/browse/SJRK-436/">Next: SJRK-436 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>