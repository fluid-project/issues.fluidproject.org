<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-scheme="light">
    <head>
        <title> SJRK-459  | Fluid Project Issues Archive</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta name="description" content="Archive of Fluid Project issues from the JIRA issue tracker">
        <meta property="og:title" content=" SJRK-459 |  Fluid Project Issues Archive">
        <meta property="og:description" content="Archive of Fluid Project issues">
        <meta property="og:locale" content="en">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://issues.fluidproject.org/browse/SJRK-459/">
        <link rel="canonical" href="https://issues.fluidproject.org/browse/SJRK-459/">


        <link rel="stylesheet" href="/assets/styles/style.css">

        
<script type="module" src="/assets/scripts/relative-time/bundle.js"></script>

    </head>
    <body class="page-issue">
        <header class="mt-3">
            <a class="skip-link" href="#main">Skip to Content</a>
            <nav aria-label="main menu">
                <menu>
                    <li><a rel="home" href="/">Home</a></li>
                    <li><a href="/search/">Search</a></li>
                </menu>
            </nav>
            
        <nav aria-label="breadcrumbs">
            <ol>
                <li><a rel="home" href="/">Home</a></li>
                <li><a href="/projects/SJRK" data-pagefind-filter="project">Social Justice Repair Kit</a></li>
                <li><a href="/browse/SJRK-459/">SJRK-459</a></li>
            </ol>
        </nav>
        <h1>SJRK-459: blockUi-timeBased-Tests are failing in CI </h1>

        </header>
        <main id="main">
            
    <div id="content" class="content with-sidebar">
        <div class="spacing-y-1 bg-default">
            <h2>Metadata</h2>
            <dl>
                <div>
                    <dt>Source</dt>
                    <dd><a href="https://fluidproject.atlassian.net/browse/SJRK-459">SJRK-459</a></dd>
                </div>
                <div>
                    <dt>Type</dt>
                    <dd>
                        <a href="/projects/SJRK/?type=Bug">Bug</a>
                    </dd>
                </div>
                <div>
                    <dt>Priority</dt>
                    <dd>Major</dd>
                </div>
                <div>
                    <dt>Status</dt>
                    <dd>Closed</dd>
                </div>
                <div>
                    <dt>Resolution</dt>
                    <dd>
                            <a href="/projects/SJRK/?resolution=Fixed">Fixed</a>
                        
                    </dd>
                </div>
                <div>
                    <dt>Assignee</dt>
                    <dd>N/A</dd>
                </div>
                <div>
                    <dt>Reporter</dt>
                    <dd>
                        <a href="/projects/SJRK/?reporter=Justin%20Obara">Justin Obara</a>
                    </dd>
                </div>
                <div>
                    <dt>Created</dt>
                    <dd><relative-time datetime="2021-03-08T12:24:21.270-0500" prefix="">2021-03-08T12:24:21.270-0500</relative-time></dd>
                </div>
                <div>
                    <dt>Updated</dt>
                    <dd><relative-time datetime="2021-03-15T11:19:11.846-0400" prefix="">2021-03-15T11:19:11.846-0400</relative-time></dd>
                </div>
                <div>
                    <dt>Versions</dt>
                    <dd>
                        
                        N/A
                        
                    </dd>
                </div>
                <div>
                    <dt>Fixed Versions</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>0.5</li>
                            
                        </ol>
                        
                    </dd>
                </div>
                <div>
                    <dt>Component</dt>
                    <dd>
                        
                        <ol role="list">
                            
                            <li>Storytelling Tool UI</li>
                            
                        </ol>
                        
                    </dd>
                </div>
            </dl>
        </div>

        <div>
            <div class="spacing-y-1">
                <h2>Description</h2>
                <p>The blockUi-timeBased-Tests are timing out/failing in CI builds. (See: <a href="https://matrix.to/#/!mDigWuPWilYGiEcOCA:matrix.org/$jfey1CEITPQgccin3rxcWOZ2f4urcOdmIhDSFEt3rTE?via=matrix.org">fluid-work matrix discussion</a>) These tests use a video file for the tests and have had issues in the past related to video format (See: <a href="/browse/SJRK-122/">SJRK-122</a>).</p>
<p>These test failures actually appeared without any new code being committed to the repo. However, the Ubuntu test runner was updated to use the latest version of FF, v86. The tests have a <a href="https://github.com/fluid-project/sjrk-story-telling/blob/c33fe086d5cafd6fbb3b665ba854a2c9a29d4ecc/tests/ui/js/blockUi-timeBasedTests.js#L18-L29">context awareness check for mp4 support</a>. However in this version of FF it the <code>canPlayType</code> function returns "maybe" instead of "". Which causes the check to pass and the mp4 file to be used. Running FF in Ubuntu requires the webM version to be used.</p>
<p>Interestingly the tests pass after a page reload. Presumably that is enough to tell the browser that the video, in fact, will not play and provide the expected response to the canPlayType function. This is not suitable for the tests though.</p>

            </div>
            
            
            
            
            <div class="spacing-y-1">
                <h2>Comments</h2>
                <ul class="spacing-y-2" role="list">
                    
                    <li id="comment-26645">
                        <p class="mb-0"><b>Justin Obara</b> <i>commented <relative-time datetime="2021-03-08T12:28:39.659-0500">2021-03-08T12:28:39.659-0500</relative-time></i></p>
                        <p>I tried the following possible solutions, the last one is the one that seemed to work.</p>
<ol>
<li>change the support check to test if canPlayType returns "probably".
<ol>
<li>Caused the tests to fail in Safari.</li>
</ol>
</li>
<li>provide multiple sources in the video element.
<ol>
<li>The video was still trying to use the mp4 format despite having access to both the mp4 and webm versions. It also didn't appear to matter what order the sources were added in.</li>
</ol>
</li>
<li>change the context check to see if webm is supported and fallback to mp4 instead of the other way around.
<ol>
<li>this appears to work.</li>
</ol>
</li>
</ol>
<p></p>
<p></p>

                    </li>
                    
                    <li id="comment-26646">
                        <p class="mb-0"><b>Justin Obara</b> <i>commented <relative-time datetime="2021-03-08T12:32:27.997-0500">2021-03-08T12:32:27.997-0500</relative-time></i></p>
                        <p>Being worked on along with <a href="/browse/SJRK-455/">SJRK-455</a></p>

                    </li>
                    
                    <li id="comment-26647">
                        <p class="mb-0"><b>Justin Obara</b> <i>commented <relative-time datetime="2021-03-15T11:19:11.845-0400">2021-03-15T11:19:11.845-0400</relative-time></i></p>
                        <p>Address in the PR for&#160;<a href="/browse/SJRK-455/">SJRK-455</a></p>
<p>Merged PR ( <a href="https://github.com/fluid-project/sjrk-story-telling/pull/114">https://github.com/fluid-project/sjrk-story-telling/pull/114</a>&#160;) at&#160;ffa60fe828fa816fadca949aaccbec6f682b7ebe</p>

                    </li>
                    
                </ul>
            </div>
            
        </div>
    </div>

        </main>
        <footer>
            
<nav aria-labelledby="pagination">
    <h2 class="visually-hidden">pagination</h2>
    <p class="flex">
        
        
        <a class="mx-1" href="/browse/SJRK-458/"><span class="aria-hidden">←</span> Previous: SJRK-458</a>
        <a class="mx-1" href="/browse/SJRK-460/">Next: SJRK-460 <span class="aria-hidden">→</span></a>
    </p>
</nav>

        </footer>
    </body>
</html>